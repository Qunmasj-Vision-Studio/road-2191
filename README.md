### 1.èƒŒæ™¯æ„ä¹‰

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€åŸå¸‚åŒ–è¿›ç¨‹çš„åŠ é€Ÿï¼Œäº¤é€šç®¡ç†ä¸é“è·¯ç›‘æµ‹çš„é‡è¦æ€§æ—¥ç›Šå‡¸æ˜¾ã€‚é¥æ„ŸæŠ€æœ¯çš„å¿«é€Ÿå‘å±•ä¸ºé“è·¯æ£€æµ‹ä¸åˆ†å‰²æä¾›äº†æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚ç¯å¢ƒä¸‹ï¼Œä¼ ç»Ÿçš„äººå·¥æ£€æµ‹æ–¹æ³•å¾€å¾€æ•ˆç‡ä½ä¸‹ä¸”å®¹æ˜“å‡ºé”™ã€‚å› æ­¤ï¼ŒåŸºäºé¥æ„Ÿå›¾åƒçš„è‡ªåŠ¨åŒ–é“è·¯æ£€æµ‹ç³»ç»Ÿæˆä¸ºäº†ç ”ç©¶çš„çƒ­ç‚¹ä¹‹ä¸€ã€‚è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„è¿›æ­¥ï¼Œå°¤å…¶æ˜¯ç›®æ ‡æ£€æµ‹ç®—æ³•çš„ä¸æ–­æ¼”åŒ–ï¼Œä½¿å¾—è®¡ç®—æœºè§†è§‰åœ¨é“è·¯æ£€æµ‹é¢†åŸŸå±•ç°å‡ºå¼ºå¤§çš„æ½œåŠ›ã€‚YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—ç®—æ³•å› å…¶é«˜æ•ˆæ€§å’Œå®æ—¶æ€§è€Œå¤‡å—å…³æ³¨ï¼Œå°¤å…¶æ˜¯YOLOv11çš„æ¨å‡ºï¼Œä¸ºè§£å†³é¥æ„Ÿå›¾åƒä¸­çš„é“è·¯æ£€æµ‹é—®é¢˜æä¾›äº†æ–°çš„æ€è·¯ã€‚

æœ¬ç ”ç©¶æ—¨åœ¨åŸºäºæ”¹è¿›çš„YOLOv11ç®—æ³•ï¼Œæ„å»ºä¸€ä¸ªé«˜æ•ˆçš„é¥æ„Ÿå›¾åƒé“è·¯æ£€æµ‹åˆ†å‰²ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿå°†ä¸“æ³¨äºè¯†åˆ«å’Œåˆ†å‰²é¥æ„Ÿå›¾åƒä¸­çš„é“è·¯ä¿¡æ¯ï¼Œå¸®åŠ©ç›¸å…³éƒ¨é—¨è¿›è¡Œäº¤é€šè§„åˆ’ã€é“è·¯ç»´æŠ¤å’Œå®‰å…¨ç›‘æµ‹ã€‚é€šè¿‡ä½¿ç”¨ä¸€ä¸ªåŒ…å«217å¹…å›¾åƒçš„ä¸“ç”¨æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†ä¸“æ³¨äºé“è·¯è¿™ä¸€å•ä¸€ç±»åˆ«ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘æ¨¡å‹è®­ç»ƒçš„å¤æ‚æ€§ï¼Œå¹¶æé«˜æ£€æµ‹ç²¾åº¦ã€‚æ­¤å¤–ï¼Œæ•°æ®é›†é‡‡ç”¨YOLOv8æ ¼å¼è¿›è¡Œæ ‡æ³¨ï¼Œç¡®ä¿äº†ä¸ç°æœ‰æ·±åº¦å­¦ä¹ æ¡†æ¶çš„å…¼å®¹æ€§ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå‡†ç¡®çš„é“è·¯æ£€æµ‹ä¸ä»…èƒ½å¤Ÿæå‡äº¤é€šç®¡ç†çš„æ•ˆç‡ï¼Œè¿˜èƒ½ä¸ºæ™ºèƒ½äº¤é€šç³»ç»Ÿçš„æ„å»ºæä¾›åŸºç¡€æ•°æ®æ”¯æŒã€‚éšç€æ™ºèƒ½åŸå¸‚çš„ä¸æ–­å‘å±•ï¼ŒåŸºäºé¥æ„Ÿå›¾åƒçš„é“è·¯æ£€æµ‹æŠ€æœ¯å°†æˆä¸ºæœªæ¥äº¤é€šç®¡ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å› æ­¤ï¼Œæœ¬ç ”ç©¶çš„å¼€å±•å…·æœ‰é‡è¦çš„ç†è®ºä»·å€¼å’Œå®é™…æ„ä¹‰ï¼Œèƒ½å¤Ÿä¸ºç›¸å…³é¢†åŸŸçš„ç ”ç©¶æä¾›æ–°çš„æ€è·¯å’Œæ–¹æ³•ï¼ŒåŒæ—¶æ¨åŠ¨é¥æ„ŸæŠ€æœ¯ä¸æ·±åº¦å­¦ä¹ çš„ç»“åˆï¼Œä¸ºæ™ºèƒ½äº¤é€šçš„å®ç°å¥ å®šåŸºç¡€ã€‚

### 2.è§†é¢‘æ•ˆæœ

[2.1 è§†é¢‘æ•ˆæœ](https://www.bilibili.com/video/BV1XnU6YhEap/)

### 3.å›¾ç‰‡æ•ˆæœ

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### [é¡¹ç›®æ¶‰åŠçš„æºç æ•°æ®æ¥æºé“¾æ¥](https://kdocs.cn/l/cszuIiCKVNis)**

æ³¨æ„ï¼šæœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,ç”±äºç‰ˆæœ¬æŒç»­æ›´æ–°,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,è¯·æŒ‰ç…§6.è®­ç»ƒæ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°ä¸Šå›¾æ¼”ç¤ºçš„æ•ˆæœã€‚

### 4.æ•°æ®é›†ä¿¡æ¯

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†ç±»åˆ«æ•°ï¼†ç±»åˆ«å

nc: 1
names: ['road']



è¯¥é¡¹ç›®ä¸ºã€å›¾åƒåˆ†å‰²ã€‘æ•°æ®é›†ï¼Œè¯·åœ¨ã€è®­ç»ƒæ•™ç¨‹å’ŒWebç«¯åŠ è½½æ¨¡å‹æ•™ç¨‹ï¼ˆç¬¬ä¸‰æ­¥ï¼‰ã€‘è¿™ä¸€æ­¥çš„æ—¶å€™æŒ‰ç…§ã€å›¾åƒåˆ†å‰²ã€‘éƒ¨åˆ†çš„æ•™ç¨‹æ¥è®­ç»ƒ

##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æœ¬é¡¹ç›®æ‰€ä½¿ç”¨çš„æ•°æ®é›†ä¸“æ³¨äºé¥æ„Ÿå›¾åƒä¸­çš„é“è·¯æ£€æµ‹ä¸åˆ†å‰²ï¼Œæ—¨åœ¨ä¸ºæ”¹è¿›YOLOv11æ¨¡å‹æä¾›é«˜è´¨é‡çš„è®­ç»ƒç´ æã€‚æ•°æ®é›†çš„ä¸»é¢˜ä¸ºâ€œroad 2â€ï¼Œä¸»è¦åŒ…å«ä¸é“è·¯ç›¸å…³çš„å›¾åƒæ•°æ®ï¼Œæ—¨åœ¨æå‡æ¨¡å‹åœ¨å¤æ‚ç¯å¢ƒä¸‹çš„é“è·¯è¯†åˆ«èƒ½åŠ›ã€‚è¯¥æ•°æ®é›†çš„ç±»åˆ«æ•°é‡ä¸º1ï¼Œå…·ä½“ç±»åˆ«ä¸ºâ€œroadâ€ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰çš„æ ‡æ³¨å‡å›´ç»•é“è·¯çš„ç‰¹å¾å±•å¼€ï¼Œç¡®ä¿æ¨¡å‹èƒ½å¤Ÿä¸“æ³¨äºé“è·¯çš„æ£€æµ‹ä¸åˆ†å‰²ä»»åŠ¡ã€‚

åœ¨æ•°æ®é›†çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œç‰¹åˆ«æ³¨é‡å›¾åƒçš„å¤šæ ·æ€§ä¸ä»£è¡¨æ€§ï¼Œä»¥æ¶µç›–ä¸åŒåœ°ç†ç¯å¢ƒã€å¤©æ°”æ¡ä»¶å’Œå…‰ç…§å˜åŒ–ä¸‹çš„é“è·¯ç‰¹å¾ã€‚è¿™ç§å¤šæ ·æ€§ä¸ä»…æœ‰åŠ©äºæå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œè¿˜èƒ½å¢å¼ºå…¶åœ¨å®é™…åº”ç”¨ä¸­çš„é²æ£’æ€§ã€‚æ•°æ®é›†ä¸­çš„å›¾åƒæ¥æºäºå¤šç§é¥æ„Ÿå¹³å°ï¼Œæ¶µç›–åŸå¸‚ã€ä¹¡æ‘ã€å±±åŒºç­‰å¤šç§åœºæ™¯ï¼Œç¡®ä¿æ¨¡å‹èƒ½å¤Ÿåœ¨ä¸åŒçš„èƒŒæ™¯ä¸‹æœ‰æ•ˆè¯†åˆ«é“è·¯ã€‚

æ­¤å¤–ï¼Œæ•°æ®é›†ä¸­çš„æ¯ä¸€å¹…å›¾åƒå‡ç»è¿‡ç²¾ç»†çš„æ ‡æ³¨ï¼Œç¡®ä¿é“è·¯åŒºåŸŸçš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚è¿™ç§é«˜è´¨é‡çš„æ ‡æ³¨ä¸ºæ¨¡å‹çš„è®­ç»ƒæä¾›äº†åšå®çš„åŸºç¡€ï¼Œä½¿å…¶èƒ½å¤Ÿå­¦ä¹ åˆ°é“è·¯çš„å½¢çŠ¶ã€å®½åº¦åŠå…¶ä¸å‘¨å›´ç¯å¢ƒçš„å…³ç³»ã€‚é€šè¿‡å¯¹è¿™äº›æ•°æ®çš„æ·±å…¥åˆ†æä¸å­¦ä¹ ï¼Œæ¨¡å‹å°†èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£é“è·¯åœ¨ä¸åŒåœºæ™¯ä¸­çš„è¡¨ç°ï¼Œä»è€Œå®ç°æ›´ä¸ºç²¾å‡†çš„æ£€æµ‹ä¸åˆ†å‰²ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæœ¬é¡¹ç›®çš„æ•°æ®é›†ä¸ä»…ä¸ºYOLOv11çš„æ”¹è¿›æä¾›äº†å¿…è¦çš„è®­ç»ƒç´ æï¼Œè¿˜é€šè¿‡å…¶ä¸°å¯Œçš„å¤šæ ·æ€§å’Œé«˜è´¨é‡çš„æ ‡æ³¨ï¼ŒåŠ©åŠ›äºå®ç°æ›´é«˜æ•ˆçš„é¥æ„Ÿå›¾åƒé“è·¯æ£€æµ‹ä¸åˆ†å‰²ç³»ç»Ÿã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 æ‰€éœ€è½¯ä»¶PyCharmå’ŒAnacondaå®‰è£…æ•™ç¨‹ï¼ˆç¬¬ä¸€æ­¥ï¼‰](https://www.bilibili.com/video/BV1BoC1YCEKi/?spm_id_from=333.999.0.0&vd_source=bc9aec86d164b67a7004b996143742dc)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹ï¼ˆç¬¬äºŒæ­¥ï¼‰](https://www.bilibili.com/video/BV1ZoC1YCEBw?spm_id_from=333.788.videopod.sections&vd_source=bc9aec86d164b67a7004b996143742dc)

### 6.æ”¹è¿›YOLOv11è®­ç»ƒæ•™ç¨‹å’ŒWeb_UIå‰ç«¯åŠ è½½æ¨¡å‹æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[6.1 æ”¹è¿›YOLOv11è®­ç»ƒæ•™ç¨‹å’ŒWeb_UIå‰ç«¯åŠ è½½æ¨¡å‹æ•™ç¨‹ï¼ˆç¬¬ä¸‰æ­¥ï¼‰](https://www.bilibili.com/video/BV1BoC1YCEhR?spm_id_from=333.788.videopod.sections&vd_source=bc9aec86d164b67a7004b996143742dc)


æŒ‰ç…§ä¸Šé¢çš„è®­ç»ƒè§†é¢‘æ•™ç¨‹é“¾æ¥åŠ è½½é¡¹ç›®æä¾›çš„æ•°æ®é›†ï¼Œè¿è¡Œtrain.pyå³å¯å¼€å§‹è®­ç»ƒ
ï»¿


     Epoch   gpu_mem       box       obj       cls    labels  img_size
     1/200     20.8G   0.01576   0.01955  0.007536        22      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [14:42<00:00,  1.04s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 213/213 [01:14<00:00,  2.87it/s]
                 all       3395      17314      0.994      0.957      0.0957      0.0843

     Epoch   gpu_mem       box       obj       cls    labels  img_size
     2/200     20.8G   0.01578   0.01923  0.007006        22      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [14:44<00:00,  1.04s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 213/213 [01:12<00:00,  2.95it/s]
                 all       3395      17314      0.996      0.956      0.0957      0.0845

     Epoch   gpu_mem       box       obj       cls    labels  img_size
     3/200     20.8G   0.01561    0.0191  0.006895        27      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [10:56<00:00,  1.29it/s]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 187/213 [00:52<00:00,  4.04it/s]
                 all       3395      17314      0.996      0.957      0.0957      0.0845




###### [é¡¹ç›®æ•°æ®é›†ä¸‹è½½é“¾æ¥](https://kdocs.cn/l/cszuIiCKVNis)

### 7.åŸå§‹YOLOv11ç®—æ³•è®²è§£

YOLOv11æ˜¯Ultralyticsæ¨å‡ºçš„YOLOç³»åˆ—æœ€æ–°ç‰ˆæœ¬ï¼Œä¸“ä¸ºå®ç°å°–ç«¯çš„ç‰©ä½“æ£€æµ‹è€Œè®¾è®¡ã€‚å…¶æ¶æ„å’Œè®­ç»ƒæ–¹æ³•ä¸Šè¿›è¡Œäº†é‡å¤§æ”¹è¿›ï¼Œä½¿ä¹‹ä¸ä»…å…·å¤‡å“è¶Šçš„å‡†ç¡®æ€§å’Œå¤„ç†é€Ÿåº¦ï¼Œè¿˜åœ¨è®¡ç®—æ•ˆç‡ä¸Šå®ç°äº†ä¸€åœºé©å‘½ã€‚å¾—ç›Šäºå…¶æ”¹è¿›çš„ä¸»å¹²å’Œé¢ˆéƒ¨æ¶æ„ï¼ŒYOLOv11åœ¨ç‰¹å¾æå–å’Œå¤„ç†å¤æ‚ä»»åŠ¡æ—¶è¡¨ç°æ›´åŠ å‡ºè‰²ã€‚åœ¨2024å¹´9æœˆ27æ—¥ï¼ŒUltralyticsé€šè¿‡é•¿è¾¾ä¹å°æ—¶çš„åœ¨çº¿ç›´æ’­å‘å¸ƒè¿™ä¸€æ–°ä½œï¼Œå±•ç¤ºäº†å…¶åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„é©æ–°ã€‚

YOLOv11é€šè¿‡ç²¾ç»†çš„æ¶æ„è®¾è®¡å’Œä¼˜åŒ–è®­ç»ƒæµç¨‹ï¼Œåœ¨ä¿æŒé«˜ç²¾åº¦çš„åŒæ—¶ï¼Œç¼©å‡äº†å‚æ•°é‡ï¼Œä¸YOLOv8mç›¸æ¯”å‡å°‘äº†22%çš„å‚æ•°ï¼Œä½¿å…¶åœ¨COCOæ•°æ®é›†ä¸Šçš„å¹³å‡å‡†ç¡®åº¦ï¼ˆmAPï¼‰æœ‰æ‰€æå‡ã€‚è¿™ç§æ•ˆç‡çš„æé«˜ä½¿YOLOv11éå¸¸é€‚åˆéƒ¨ç½²åœ¨å„ç§ç¡¬ä»¶ç¯å¢ƒä¸­ï¼ŒåŒ…æ‹¬è¾¹ç¼˜è®¾å¤‡ã€äº‘è®¡ç®—å¹³å°ä»¥åŠæ”¯æŒNVIDIA GPUçš„ç³»ç»Ÿï¼Œç¡®ä¿åœ¨çµæ´»æ€§ä¸Šçš„ä¼˜åŠ¿ã€‚

è¯¥æ¨¡å‹æ”¯æŒå¹¿æ³›çš„ä»»åŠ¡ï¼Œä»å¯¹è±¡æ£€æµ‹ã€å®ä¾‹åˆ†å‰²åˆ°å›¾åƒåˆ†ç±»ã€å§¿æ€ä¼°è®¡å’Œå®šå‘å¯¹è±¡æ£€æµ‹ï¼ˆOBBï¼‰ï¼Œå‡ ä¹è¦†ç›–äº†è®¡ç®—æœºè§†è§‰çš„æ‰€æœ‰ä¸»è¦æŒ‘æˆ˜ã€‚å…¶åˆ›æ–°çš„C3k2å’ŒC2PSAæ¨¡å—æå‡äº†ç½‘ç»œæ·±åº¦å’Œæ³¨æ„åŠ›æœºåˆ¶çš„åº”ç”¨ï¼Œæé«˜äº†ç‰¹å¾æå–çš„æ•ˆç‡å’Œæ•ˆæœã€‚åŒæ—¶ï¼ŒYOLOv11çš„æ”¹è¿›ç½‘ç»œç»“æ„ä¹Ÿä½¿ä¹‹åœ¨å¤æ‚è§†è§‰ä»»åŠ¡ä¸Šå¾—ä»¥ä»å®¹åº”å¯¹ï¼Œæˆä¸ºå„ç±»è®¡ç®—æœºè§†è§‰ä»»åŠ¡çš„å¤šåŠŸèƒ½é€‰æ‹©ã€‚è¿™äº›ç‰¹æ€§ä»¤YOLOv11åœ¨å®æ–½å®æ—¶ç‰©ä½“æ£€æµ‹çš„å„ä¸ªé¢†åŸŸä¸­è¡¨ç°å‡ºä¼—ã€‚
* * *

2024å¹´9æœˆ27æ—¥ï¼ŒUltralyticsåœ¨çº¿ç›´æ’­é•¿è¾¾ä¹å°æ—¶ï¼Œä¸ºYOLO11å¬å¼€â€œå‘å¸ƒä¼šâ€

YOLO11 æ˜¯ Ultralytics YOLO ç³»åˆ—å®æ—¶ç‰©ä½“æ£€æµ‹å™¨çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå®ƒä»¥å°–ç«¯çš„å‡†ç¡®æ€§ã€é€Ÿåº¦å’Œæ•ˆç‡é‡æ–°å®šä¹‰äº†å¯èƒ½æ€§ã€‚åœ¨ä¹‹å‰ YOLO
ç‰ˆæœ¬çš„æ˜¾è‘—è¿›æ­¥çš„åŸºç¡€ä¸Šï¼ŒYOLO11 åœ¨æ¶æ„å’Œè®­ç»ƒæ–¹æ³•æ–¹é¢è¿›è¡Œäº†é‡å¤§æ”¹è¿›ï¼Œä½¿å…¶æˆä¸ºå„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡çš„å¤šåŠŸèƒ½é€‰æ‹©ã€‚

![](https://i-blog.csdnimg.cn/direct/a4e1a178833746249720ccee1c82a58b.png)

##### YOLO11ä¸»è¦ç‰¹ç‚¹ï¼š

  * å¢å¼ºçš„ç‰¹å¾æå–ï¼šYOLO11 é‡‡ç”¨äº†æ”¹è¿›çš„ä¸»å¹²å’Œé¢ˆéƒ¨æ¶æ„ï¼Œå¢å¼ºäº†ç‰¹å¾æå–èƒ½åŠ›ï¼Œå¯å®ç°æ›´ç²¾ç¡®çš„å¯¹è±¡æ£€æµ‹å’Œå¤æ‚ä»»åŠ¡æ€§èƒ½ã€‚
  * é’ˆå¯¹æ•ˆç‡å’Œé€Ÿåº¦è¿›è¡Œäº†ä¼˜åŒ–ï¼šYOLO11 å¼•å…¥äº†å®Œå–„çš„æ¶æ„è®¾è®¡å’Œä¼˜åŒ–çš„è®­ç»ƒæµç¨‹ï¼Œå¯æä¾›æ›´å¿«çš„å¤„ç†é€Ÿåº¦ï¼Œå¹¶åœ¨å‡†ç¡®åº¦å’Œæ€§èƒ½ä¹‹é—´ä¿æŒæœ€ä½³å¹³è¡¡ã€‚
  * æ›´å°‘çš„å‚æ•°ï¼Œæ›´é«˜çš„å‡†ç¡®åº¦ï¼šå€ŸåŠ©æ¨¡å‹è®¾è®¡çš„è¿›æ­¥ï¼ŒYOLO11m åœ¨ COCO æ•°æ®é›†ä¸Šå®ç°äº†æ›´é«˜çš„å¹³å‡å‡†ç¡®åº¦ (mAP)ï¼ŒåŒæ—¶ä½¿ç”¨çš„å‚æ•°æ¯” YOLOv8m å°‘ 22%ï¼Œä»è€Œæé«˜äº†è®¡ç®—æ•ˆç‡ï¼ŒåŒæ—¶åˆä¸å½±å“å‡†ç¡®åº¦ã€‚
  * è·¨ç¯å¢ƒçš„é€‚åº”æ€§ï¼šYOLO11 å¯ä»¥æ— ç¼éƒ¨ç½²åœ¨å„ç§ç¯å¢ƒä¸­ï¼ŒåŒ…æ‹¬è¾¹ç¼˜è®¾å¤‡ã€äº‘å¹³å°å’Œæ”¯æŒ NVIDIA GPU çš„ç³»ç»Ÿï¼Œä»è€Œç¡®ä¿æœ€å¤§çš„çµæ´»æ€§ã€‚
  * æ”¯æŒçš„ä»»åŠ¡èŒƒå›´å¹¿æ³›ï¼šæ— è®ºæ˜¯å¯¹è±¡æ£€æµ‹ã€å®ä¾‹åˆ†å‰²ã€å›¾åƒåˆ†ç±»ã€å§¿åŠ¿ä¼°è®¡è¿˜æ˜¯å®šå‘å¯¹è±¡æ£€æµ‹ (OBB)ï¼ŒYOLO11 éƒ½æ—¨åœ¨æ»¡è¶³å„ç§è®¡ç®—æœºè§†è§‰æŒ‘æˆ˜ã€‚

##### æ”¯æŒçš„ä»»åŠ¡å’Œæ¨¡å¼

YOLO11 ä»¥ YOLOv8 ä¸­å¼•å…¥çš„å¤šåŠŸèƒ½æ¨¡å‹ç³»åˆ—ä¸ºåŸºç¡€ï¼Œä¸ºå„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡æä¾›å¢å¼ºçš„æ”¯æŒï¼š

Model| Filenames| Task| Inference| Validation| Training| Export  
---|---|---|---|---|---|---  
YOLO11| yolol11n.pt, yolol11s.pt, yolol11m.pt, yolol11x.pt| Detection| âœ…| âœ…|
âœ…| âœ…  
YOLO11-seg| yolol11n-seg.pt, yolol11s-seg.pt, yolol11m-seg.pt,
yolol11x-seg.pt| Instance Segmentation| âœ…| âœ…| âœ…| âœ…  
YOLO11-pose| yolol11n-pose.pt, yolol11s-pose.pt, yolol11m-pose.pt,
yolol11x-pose.pt| Pose/Keypoints| âœ…| âœ…| âœ…| âœ…  
YOLO11-obb| yolol11n-obb.pt, yolol11s-obb.pt, yolol11m-obb.pt,
yolol11x-obb.pt| Oriented Detection| âœ…| âœ…| âœ…| âœ…  
YOLO11-cls| yolol11n-cls.pt, yolol11s-cls.pt, yolol11m-cls.pt,
yolol11x-cls.pt| Classification| âœ…| âœ…| âœ…| âœ…  
  
##### ç®€å•çš„ YOLO11 è®­ç»ƒå’Œæ¨ç†ç¤ºä¾‹

ä»¥ä¸‹ç¤ºä¾‹é€‚ç”¨äºç”¨äºå¯¹è±¡æ£€æµ‹çš„ YOLO11 Detect æ¨¡å‹ã€‚

    
    
    from ultralytics import YOLO
    
    # Load a model
    model = YOLO("yolo11n.pt")
    
    # Train the model
    train_results = model.train(
        data="coco8.yaml",  # path to dataset YAML
        epochs=100,  # number of training epochs
        imgsz=640,  # training image size
        device="cpu",  # device to run on, i.e. device=0 or device=0,1,2,3 or device=cpu
    )
    
    # Evaluate model performance on the validation set
    metrics = model.val()
    
    # Perform object detection on an image
    results = model("path/to/image.jpg")
    results[0].show()
    
    # Export the model to ONNX format
    path = model.export(format="onnx")  # return path to exported model

##### æ”¯æŒéƒ¨ç½²äºè¾¹ç¼˜è®¾å¤‡

YOLO11 ä¸“ä¸ºé€‚åº”å„ç§ç¯å¢ƒè€Œè®¾è®¡ï¼ŒåŒ…æ‹¬è¾¹ç¼˜è®¾å¤‡ã€‚å…¶ä¼˜åŒ–çš„æ¶æ„å’Œé«˜æ•ˆçš„å¤„ç†èƒ½åŠ›ä½¿å…¶é€‚åˆéƒ¨ç½²åœ¨è¾¹ç¼˜è®¾å¤‡ã€äº‘å¹³å°å’Œæ”¯æŒ NVIDIA GPU
çš„ç³»ç»Ÿä¸Šã€‚è¿™ç§çµæ´»æ€§ç¡®ä¿ YOLO11 å¯ç”¨äºå„ç§åº”ç”¨ï¼Œä»ç§»åŠ¨è®¾å¤‡ä¸Šçš„å®æ—¶æ£€æµ‹åˆ°äº‘ç¯å¢ƒä¸­çš„å¤æ‚åˆ†å‰²ä»»åŠ¡ã€‚æœ‰å…³éƒ¨ç½²é€‰é¡¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¯¼å‡ºæ–‡æ¡£ã€‚

##### YOLOv11 yamlæ–‡ä»¶

    
    
    # Ultralytics YOLO ğŸš€, AGPL-3.0 license
    # YOLO11 object detection model with P3-P5 outputs. For Usage examples see https://docs.ultralytics.com/tasks/detect
    
    # Parameters
    nc: 80 # number of classes
    scales: # model compound scaling constants, i.e. 'model=yolo11n.yaml' will call yolo11.yaml with scale 'n'
      # [depth, width, max_channels]
      n: [0.50, 0.25, 1024] # summary: 319 layers, 2624080 parameters, 2624064 gradients, 6.6 GFLOPs
      s: [0.50, 0.50, 1024] # summary: 319 layers, 9458752 parameters, 9458736 gradients, 21.7 GFLOPs
      m: [0.50, 1.00, 512] # summary: 409 layers, 20114688 parameters, 20114672 gradients, 68.5 GFLOPs
      l: [1.00, 1.00, 512] # summary: 631 layers, 25372160 parameters, 25372144 gradients, 87.6 GFLOPs
      x: [1.00, 1.50, 512] # summary: 631 layers, 56966176 parameters, 56966160 gradients, 196.0 GFLOPs
    
    # YOLO11n backbone
    backbone:
      # [from, repeats, module, args]
      - [-1, 1, Conv, [64, 3, 2]] # 0-P1/2
      - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4
      - [-1, 2, C3k2, [256, False, 0.25]]
      - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
      - [-1, 2, C3k2, [512, False, 0.25]]
      - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
      - [-1, 2, C3k2, [512, True]]
      - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
      - [-1, 2, C3k2, [1024, True]]
      - [-1, 1, SPPF, [1024, 5]] # 9
      - [-1, 2, C2PSA, [1024]] # 10
    
    # YOLO11n head
    head:
      - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
      - [[-1, 6], 1, Concat, [1]] # cat backbone P4
      - [-1, 2, C3k2, [512, False]] # 13
    
      - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
      - [[-1, 4], 1, Concat, [1]] # cat backbone P3
      - [-1, 2, C3k2, [256, False]] # 16 (P3/8-small)
    
      - [-1, 1, Conv, [256, 3, 2]]
      - [[-1, 13], 1, Concat, [1]] # cat head P4
      - [-1, 2, C3k2, [512, False]] # 19 (P4/16-medium)
    
      - [-1, 1, Conv, [512, 3, 2]]
      - [[-1, 10], 1, Concat, [1]] # cat head P5
      - [-1, 2, C3k2, [1024, True]] # 22 (P5/32-large)
    
      - [[16, 19, 22], 1, Detect, [nc]] # Detect(P3, P4, P5)
    

**YOLO11å’ŒYOLOv8 yamlæ–‡ä»¶çš„åŒºåˆ«**

![](https://i-blog.csdnimg.cn/direct/a8f3766a015c4ad2a49411ab710b3477.png)

##### æ”¹è¿›æ¨¡å—ä»£ç 

  * C3k2 

    
    
    class C3k2(C2f):
        """Faster Implementation of CSP Bottleneck with 2 convolutions."""
    
        def __init__(self, c1, c2, n=1, c3k=False, e=0.5, g=1, shortcut=True):
            """Initializes the C3k2 module, a faster CSP Bottleneck with 2 convolutions and optional C3k blocks."""
            super().__init__(c1, c2, n, shortcut, g, e)
            self.m = nn.ModuleList(
                C3k(self.c, self.c, 2, shortcut, g) if c3k else Bottleneck(self.c, self.c, shortcut, g) for _ in range(n)
            )

C3k2ï¼Œå®ƒæ˜¯å…·æœ‰ä¸¤ä¸ªå·ç§¯çš„CSPï¼ˆPartial Cross Stageï¼‰ç“¶é¢ˆæ¶æ„çš„æ›´å¿«å®ç°ã€‚

**ç±»ç»§æ‰¿ï¼š**

  * `C3k2`ç»§æ‰¿è‡ªç±»`C2f`ã€‚è¿™è¡¨æ˜`C2f`å¾ˆå¯èƒ½å®ç°äº†ç»è¿‡ä¿®æ”¹çš„åŸºæœ¬CSPç»“æ„ï¼Œè€Œ`C3k2`è¿›ä¸€æ­¥ä¼˜åŒ–æˆ–ä¿®æ”¹äº†æ­¤ç»“æ„ã€‚

**æ„é€ å‡½æ•°ï¼ˆ`__init__`ï¼‰ï¼š**

  * `c1`ï¼šè¾“å…¥é€šé“ã€‚

  * `c2`ï¼šè¾“å‡ºé€šé“ã€‚

  * `n`ï¼šç“¶é¢ˆå±‚æ•°ï¼ˆé»˜è®¤ä¸º1ï¼‰ã€‚

  * `c3k`ï¼šä¸€ä¸ªå¸ƒå°”æ ‡å¿—ï¼Œç¡®å®šæ˜¯å¦ä½¿ç”¨`C3k`å—æˆ–å¸¸è§„`Bottleneck`å—ã€‚

  * `e`ï¼šæ‰©å±•æ¯”ç‡ï¼Œæ§åˆ¶éšè—å±‚çš„å®½åº¦ï¼ˆé»˜è®¤ä¸º0.5ï¼‰ã€‚

  * `g`ï¼šåˆ†ç»„å·ç§¯çš„ç»„å½’ä¸€åŒ–å‚æ•°æˆ–ç»„æ•°ï¼ˆé»˜è®¤å€¼ä¸º 1ï¼‰ã€‚

  * `shortcut`ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºç¡®å®šæ˜¯å¦åœ¨ç½‘ç»œä¸­åŒ…å«å¿«æ·æ–¹å¼è¿æ¥ï¼ˆé»˜è®¤å€¼ä¸º `True`ï¼‰ã€‚

**åˆå§‹åŒ–ï¼š**

  * `super().__init__(c1, c2, n, short-cut, g, e)` è°ƒç”¨çˆ¶ç±» `C2f` çš„æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ ‡å‡† CSP ç»„ä»¶ï¼Œå¦‚é€šé“æ•°ã€å¿«æ·æ–¹å¼ã€ç»„ç­‰ã€‚

**æ¨¡å—åˆ—è¡¨ï¼ˆ`self.m`ï¼‰ï¼š**

  * `nn.ModuleList` å­˜å‚¨ `C3k` æˆ– `Bottleneck` æ¨¡å—ï¼Œå…·ä½“å–å†³äº `c3k` çš„å€¼ã€‚

  * å¦‚æœ `c3k` ä¸º `True`ï¼Œå®ƒä¼šåˆå§‹åŒ– `C3k` æ¨¡å—ã€‚`C3k` æ¨¡å—æ¥æ”¶ä»¥ä¸‹å‚æ•°ï¼š

  * `self.c`ï¼šé€šé“æ•°ï¼ˆæºè‡ª `C2f`ï¼‰ã€‚

  * `2`ï¼šè¿™è¡¨ç¤ºåœ¨ `C3k` å—å†…ä½¿ç”¨äº†ä¸¤ä¸ªå·ç§¯å±‚ã€‚

  * `shortcut` å’Œ `g`ï¼šä» `C3k2` æ„é€ å‡½æ•°ä¼ é€’ã€‚

  * å¦‚æœ `c3k` ä¸º `False`ï¼Œåˆ™åˆå§‹åŒ–æ ‡å‡† `Bottleneck` æ¨¡å—ã€‚

`for _ in range(n)` è¡¨ç¤ºå°†åˆ›å»º `n` ä¸ªè¿™æ ·çš„å—ã€‚

**æ€»ç»“ï¼š**

  * `C3k2` å®ç°äº† CSP ç“¶é¢ˆæ¶æ„ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨è‡ªå®šä¹‰ `C3k` å—ï¼ˆå…·æœ‰ä¸¤ä¸ªå·ç§¯ï¼‰æˆ–æ ‡å‡† `Bottleneck` å—ï¼Œå…·ä½“å–å†³äº `c3k` æ ‡å¿—ã€‚

  * C2PSA

    
    
    class C2PSA(nn.Module):
        """
        C2PSA module with attention mechanism for enhanced feature extraction and processing.
    
        This module implements a convolutional block with attention mechanisms to enhance feature extraction and processing
        capabilities. It includes a series of PSABlock modules for self-attention and feed-forward operations.
    
        Attributes:
            c (int): Number of hidden channels.
            cv1 (Conv): 1x1 convolution layer to reduce the number of input channels to 2*c.
            cv2 (Conv): 1x1 convolution layer to reduce the number of output channels to c.
            m (nn.Sequential): Sequential container of PSABlock modules for attention and feed-forward operations.
    
        Methods:
            forward: Performs a forward pass through the C2PSA module, applying attention and feed-forward operations.
    
        Notes:
            This module essentially is the same as PSA module, but refactored to allow stacking more PSABlock modules.
    
        Examples:
            >>> c2psa = C2PSA(c1=256, c2=256, n=3, e=0.5)
            >>> input_tensor = torch.randn(1, 256, 64, 64)
            >>> output_tensor = c2psa(input_tensor)
        """
    
        def __init__(self, c1, c2, n=1, e=0.5):
            """Initializes the C2PSA module with specified input/output channels, number of layers, and expansion ratio."""
            super().__init__()
            assert c1 == c2
            self.c = int(c1 * e)
            self.cv1 = Conv(c1, 2 * self.c, 1, 1)
            self.cv2 = Conv(2 * self.c, c1, 1)
    
            self.m = nn.Sequential(*(PSABlock(self.c, attn_ratio=0.5, num_heads=self.c // 64) for _ in range(n)))
    
        def forward(self, x):
            """Processes the input tensor 'x' through a series of PSA blocks and returns the transformed tensor."""
            a, b = self.cv1(x).split((self.c, self.c), dim=1)
            b = self.m(b)
            return self.cv2(torch.cat((a, b), 1))

`C2PSA` æ¨¡å—æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç¥ç»ç½‘ç»œå±‚ï¼Œå¸¦æœ‰æ³¨æ„åŠ›æœºåˆ¶ï¼Œç”¨äºå¢å¼ºç‰¹å¾æå–å’Œå¤„ç†ã€‚

**ç±»æ¦‚è¿°**

  * **ç›®çš„ï¼š**

  * `C2PSA` æ¨¡å—å¼•å…¥äº†ä¸€ä¸ªå·ç§¯å—ï¼Œåˆ©ç”¨æ³¨æ„åŠ›æœºåˆ¶æ¥æ”¹è¿›ç‰¹å¾æå–å’Œå¤„ç†ã€‚

  * å®ƒä½¿ç”¨ä¸€ç³»åˆ— `PSABlock` æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯èƒ½ä»£è¡¨æŸç§å½¢å¼çš„ä½ç½®è‡ªæ³¨æ„åŠ› (PSA)ï¼Œå¹¶ä¸”è¯¥æ¶æ„æ—¨åœ¨å…è®¸å †å å¤šä¸ª `PSABlock` å±‚ã€‚

**æ„é€ å‡½æ•°ï¼ˆ`__init__`ï¼‰ï¼š**

  * **å‚æ•°ï¼š**

  * `c1`ï¼šè¾“å…¥é€šé“ï¼ˆå¿…é¡»ç­‰äº `c2`ï¼‰ã€‚

  * `c2`ï¼šè¾“å‡ºé€šé“ï¼ˆå¿…é¡»ç­‰äº `c1`ï¼‰ã€‚

  * `n`ï¼šè¦å †å çš„ `PSABlock` æ¨¡å—æ•°é‡ï¼ˆé»˜è®¤å€¼ä¸º 1ï¼‰ã€‚

  * `e`ï¼šæ‰©å±•æ¯”ç‡ï¼Œç”¨äºè®¡ç®—éšè—é€šé“çš„æ•°é‡ï¼ˆé»˜è®¤å€¼ä¸º 0.5ï¼‰ã€‚

  * **å±æ€§ï¼š**

  * `self.c`ï¼šéšè—é€šé“æ•°ï¼Œè®¡ç®—ä¸º `int(c1 * e)`ã€‚

  * `self.cv1`ï¼šä¸€ä¸ª `1x1` å·ç§¯ï¼Œå°†è¾“å…¥é€šé“æ•°ä» `c1` å‡å°‘åˆ° `2 * self.c`ã€‚è¿™ä¸ºå°†è¾“å…¥åˆ†æˆä¸¤éƒ¨åˆ†åšå¥½å‡†å¤‡ã€‚

  * `self.cv2`ï¼šå¦ä¸€ä¸ª `1x1` å·ç§¯ï¼Œå¤„ç†åå°†é€šé“ç»´åº¦æ¢å¤å› `c1`ã€‚

  * `self.m`ï¼šä¸€ç³»åˆ— `PSABlock` æ¨¡å—ã€‚æ¯ä¸ª `PSABlock` æ¥æ”¶ `self.c` é€šé“ï¼Œæ³¨æ„å¤´çš„æ•°é‡ä¸º `self.c // 64`ã€‚æ¯ä¸ªå—åº”ç”¨æ³¨æ„å’Œå‰é¦ˆæ“ä½œã€‚

**å‰å‘æ–¹æ³•ï¼š**

  * **è¾“å…¥ï¼š**

  * `x`ï¼Œè¾“å…¥å¼ é‡ã€‚

  * **æ“ä½œï¼š**

  1. `self.cv1(x)` åº”ç”¨ `1x1` å·ç§¯ï¼Œå°†è¾“å…¥é€šé“å¤§å°ä» `c1` å‡å°åˆ° `2 * self.c`ã€‚

  2. ç”Ÿæˆçš„å¼ é‡æ²¿é€šé“ç»´åº¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œ`a` å’Œ `b`ã€‚

  * `a`ï¼šç¬¬ä¸€ä¸ª `self.c` é€šé“ã€‚

  * `b`ï¼šå‰©ä½™çš„ `self.c` é€šé“ã€‚

  1. `b` é€šè¿‡é¡ºåºå®¹å™¨ `self.m`ï¼Œå®ƒæ˜¯ `PSABlock` æ¨¡å—çš„å †æ ˆã€‚è¿™éƒ¨åˆ†ç»è¿‡åŸºäºæ³¨æ„çš„å¤„ç†ã€‚

  2. å¤„ç†åçš„å¼ é‡ `b` ä¸ `a` è¿æ¥ã€‚

  3. `self.cv2` åº”ç”¨ `1x1` å·ç§¯ï¼Œå°†é€šé“å¤§å°æ¢å¤ä¸º `c1`ã€‚

  * **è¾“å‡ºï¼š**

  * åº”ç”¨æ³¨æ„å’Œå·ç§¯æ“ä½œåçš„å˜æ¢åçš„å¼ é‡ã€‚

**æ€»ç»“ï¼š**

  * **C2PSA** æ˜¯ä¸€ä¸ªå¢å¼ºå‹å·ç§¯æ¨¡å—ï¼Œå®ƒé€šè¿‡å †å çš„ `PSABlock` æ¨¡å—åº”ç”¨ä½ç½®è‡ªæ³¨æ„åŠ›ã€‚å®ƒæ‹†åˆ†è¾“å…¥å¼ é‡ï¼Œå°†æ³¨æ„åŠ›åº”ç”¨äºå…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œç„¶åé‡æ–°ç»„åˆå¹¶é€šè¿‡æœ€ç»ˆå·ç§¯å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚æ­¤ç»“æ„æœ‰åŠ©äºä»è¾“å…¥æ•°æ®ä¸­æå–å¤æ‚ç‰¹å¾ã€‚

##### ç½‘ç»œç»“æ„

![](https://i-blog.csdnimg.cn/direct/761af09befeb45adafae36b679424b26.png)

![](https://i-blog.csdnimg.cn/direct/45e481e295ad458fa7fe4c252fbd5d83.png)




### 8.200+ç§å…¨å¥—æ”¹è¿›YOLOV11åˆ›æ–°ç‚¹åŸç†è®²è§£

#### 8.1 200+ç§å…¨å¥—æ”¹è¿›YOLOV11åˆ›æ–°ç‚¹åŸç†è®²è§£å¤§å…¨

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸å…¨éƒ¨å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„æ”¹è¿›æ¨¡å—å¯¹åº”é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼ˆåˆ›æ–°ç‚¹å‡ä¸ºæ¨¡å—åŒ–æ­å»ºï¼ŒåŸç†é€‚é…YOLOv5~YOLOv11ç­‰å„ç§ç‰ˆæœ¬ï¼‰

[æ”¹è¿›æ¨¡å—æŠ€æœ¯åŸç†åšå®¢ã€Blogã€‘ç½‘å€é“¾æ¥](https://gitee.com/qunmasj/good)

![9.png](9.png)

#### 8.2 ç²¾é€‰éƒ¨åˆ†æ”¹è¿›YOLOV11åˆ›æ–°ç‚¹åŸç†è®²è§£

###### è¿™é‡ŒèŠ‚é€‰éƒ¨åˆ†æ”¹è¿›åˆ›æ–°ç‚¹å±•å¼€åŸç†è®²è§£(å®Œæ•´çš„æ”¹è¿›åŸç†è§ä¸Šå›¾å’Œ[æ”¹è¿›æ¨¡å—æŠ€æœ¯åŸç†åšå®¢é“¾æ¥](https://gitee.com/qunmasj/good)ã€å¦‚æœæ­¤å°èŠ‚çš„å›¾åŠ è½½å¤±è´¥å¯ä»¥é€šè¿‡CSDNæˆ–è€…Githubæœç´¢è¯¥åšå®¢çš„æ ‡é¢˜è®¿é—®åŸå§‹åšå®¢ï¼ŒåŸå§‹åšå®¢å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸ã€‘
ï»¿
### MS-Blockç®€ä»‹
å®æ—¶ç›®æ ‡æ£€æµ‹ï¼Œä»¥YOLOç³»åˆ—ä¸ºä¾‹ï¼Œå·²åœ¨å·¥ä¸šé¢†åŸŸä¸­æ‰¾åˆ°é‡è¦åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨è¾¹ç¼˜è®¾å¤‡ï¼ˆå¦‚æ— äººæœºå’Œæœºå™¨äººï¼‰ä¸­ã€‚ä¸ä¹‹å‰çš„ç›®æ ‡æ£€æµ‹å™¨ä¸åŒï¼Œå®æ—¶ç›®æ ‡æ£€æµ‹å™¨æ—¨åœ¨åœ¨é€Ÿåº¦å’Œå‡†ç¡®æ€§ä¹‹é—´è¿½æ±‚æœ€ä½³å¹³è¡¡ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œæå‡ºäº†å¤§é‡çš„å·¥ä½œï¼šä»ç¬¬ä¸€ä»£DarkNetåˆ°CSPNetï¼Œå†åˆ°æœ€è¿‘çš„æ‰©å±•ELANï¼Œéšç€æ€§èƒ½çš„å¿«é€Ÿå¢é•¿ï¼Œå®æ—¶ç›®æ ‡æ£€æµ‹å™¨çš„æ¶æ„ç»å†äº†å·¨å¤§çš„å˜åŒ–ã€‚

å°½ç®¡æ€§èƒ½ä»¤äººå°è±¡æ·±åˆ»ï¼Œä½†åœ¨ä¸åŒå°ºåº¦ä¸Šè¯†åˆ«å¯¹è±¡ä»ç„¶æ˜¯å®æ—¶ç›®æ ‡æ£€æµ‹å™¨é¢ä¸´çš„åŸºæœ¬æŒ‘æˆ˜ã€‚è¿™ä¿ƒä½¿ä½œè€…è®¾è®¡äº†ä¸€ä¸ªå¼ºå¤§çš„ç¼–ç å™¨æ¶æ„ï¼Œç”¨äºå­¦ä¹ å…·æœ‰è¡¨ç°åŠ›çš„å¤šå°ºåº¦ç‰¹å¾è¡¨ç¤ºã€‚å…·ä½“è€Œè¨€ï¼Œä½œè€…ä»ä¸¤ä¸ªæ–°çš„è§’åº¦è€ƒè™‘ä¸ºå®æ—¶ç›®æ ‡æ£€æµ‹ç¼–ç å¤šå°ºåº¦ç‰¹å¾ï¼š

ä»å±€éƒ¨è§†è§’å‡ºå‘ï¼Œä½œè€…è®¾è®¡äº†ä¸€ä¸ªå…·æœ‰ç®€å•è€Œæœ‰æ•ˆçš„åˆ†å±‚ç‰¹å¾èåˆç­–ç•¥çš„MS-Blockã€‚å—åˆ°Res2Netçš„å¯å‘ï¼Œä½œè€…åœ¨MS-Blockä¸­å¼•å…¥äº†å¤šä¸ªåˆ†æ”¯æ¥è¿›è¡Œç‰¹å¾æå–ï¼Œä½†ä¸åŒçš„æ˜¯ï¼Œä½œè€…ä½¿ç”¨äº†ä¸€ä¸ªå¸¦æœ‰æ·±åº¦å·ç§¯çš„ Inverted Bottleneck Blockå—ï¼Œä»¥å®ç°å¯¹å¤§Kernelçš„é«˜æ•ˆåˆ©ç”¨ã€‚

ä»å…¨å±€è§†è§’å‡ºå‘ï¼Œä½œè€…æå‡ºéšç€ç½‘ç»œåŠ æ·±é€æ¸å¢åŠ å·ç§¯çš„Kernel-Sizeã€‚ä½œè€…åœ¨æµ…å±‚ä½¿ç”¨å°Kernelå·ç§¯æ¥æ›´é«˜æ•ˆåœ°å¤„ç†é«˜åˆ†è¾¨ç‡ç‰¹å¾ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æ·±å±‚ä¸­ï¼Œä½œè€…é‡‡ç”¨å¤§Kernelå·ç§¯æ¥æ•æ‰å¹¿æ³›çš„ä¿¡æ¯ã€‚

åŸºäºä»¥ä¸Šè®¾è®¡åŸåˆ™ï¼Œä½œè€…å‘ˆç°äº†ä½œè€…çš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ï¼Œç§°ä¸ºYOLO-MSã€‚ä¸ºäº†è¯„ä¼°ä½œè€…çš„YOLO-MSçš„æ€§èƒ½ï¼Œä½œè€…åœ¨MS COCOæ•°æ®é›†ä¸Šè¿›è¡Œäº†å…¨é¢çš„å®éªŒã€‚è¿˜æä¾›äº†ä¸å…¶ä»–æœ€å…ˆè¿›æ–¹æ³•çš„å®šé‡æ¯”è¾ƒï¼Œä»¥å±•ç¤ºä½œè€…æ–¹æ³•çš„å¼ºå¤§æ€§èƒ½ã€‚å¦‚å›¾1æ‰€ç¤ºï¼ŒYOLO-MSåœ¨è®¡ç®—æ€§èƒ½å¹³è¡¡æ–¹é¢ä¼˜äºå…¶ä»–è¿‘æœŸçš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/9ab694da7c594544811a74860db51416.png)


å…·ä½“è€Œè¨€ï¼ŒYOLO-MS-XSåœ¨MS COCOä¸Šè·å¾—äº†43%+çš„APå¾—åˆ†ï¼Œä»…å…·æœ‰450ä¸‡ä¸ªå¯å­¦ä¹ å‚æ•°å’Œ8.7äº¿ä¸ªFLOPsã€‚YOLO-MS-Så’ŒYOLO-MSåˆ†åˆ«è·å¾—äº†46%+å’Œ51%+çš„APï¼Œå¯å­¦ä¹ å‚æ•°åˆ†åˆ«ä¸º810ä¸‡å’Œ2220ä¸‡ã€‚æ­¤å¤–ï¼Œä½œè€…çš„å·¥ä½œè¿˜å¯ä»¥ä½œä¸ºå…¶ä»–YOLOæ¨¡å‹çš„å³æ’å³ç”¨æ¨¡å—ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½œè€…çš„æ–¹æ³•å¯ä»¥å°†YOLOv11çš„APä»37%+æ˜¾è‘—æé«˜åˆ°40%+ï¼Œç”šè‡³è¿˜å¯ä»¥ä½¿ç”¨æ›´å°‘çš„å‚æ•°å’ŒFLOPsã€‚

CSP Blockæ˜¯ä¸€ä¸ªåŸºäºé˜¶æ®µçº§æ¢¯åº¦è·¯å¾„çš„ç½‘ç»œï¼Œå¹³è¡¡äº†æ¢¯åº¦ç»„åˆå’Œè®¡ç®—æˆæœ¬ã€‚å®ƒæ˜¯å¹¿æ³›åº”ç”¨äºYOLOç³»åˆ—çš„åŸºæœ¬æ„å»ºå—ã€‚å·²ç»æå‡ºäº†å‡ ç§å˜ä½“ï¼ŒåŒ…æ‹¬YOLOv4å’ŒYOLOv11ä¸­çš„åŸå§‹ç‰ˆæœ¬ï¼ŒScaled YOLOv4ä¸­çš„CSPVoVNetï¼ŒYOLOv11ä¸­çš„ELANï¼Œä»¥åŠRTMDetä¸­æå‡ºçš„å¤§Kernelå•å…ƒã€‚ä½œè€…åœ¨å›¾2(a)å’Œå›¾2(b)ä¸­åˆ†åˆ«å±•ç¤ºäº†åŸå§‹CSPå—å’ŒELANçš„ç»“æ„ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/d7239c693fdc4d878f9b1b31566e20f4.png)


ä¸Šè¿°å®æ—¶æ£€æµ‹å™¨ä¸­è¢«å¿½è§†çš„ä¸€ä¸ªå…³é”®æ–¹é¢æ˜¯å¦‚ä½•åœ¨åŸºæœ¬æ„å»ºå—ä¸­ç¼–ç å¤šå°ºåº¦ç‰¹å¾ã€‚å…¶ä¸­ä¸€ä¸ªå¼ºå¤§çš„è®¾è®¡åŸåˆ™æ˜¯Res2Netï¼Œå®ƒèšåˆäº†æ¥è‡ªä¸åŒå±‚æ¬¡çš„ç‰¹å¾ä»¥å¢å¼ºå¤šå°ºåº¦è¡¨ç¤ºã€‚ç„¶è€Œï¼Œè¿™ä¸€åŸåˆ™å¹¶æ²¡æœ‰å……åˆ†æ¢ç´¢å¤§Kernelå·ç§¯çš„ä½œç”¨ï¼Œè€Œå¤§Kernelå·ç§¯å·²ç»åœ¨åŸºäºCNNçš„è§†è§‰è¯†åˆ«ä»»åŠ¡æ¨¡å‹ä¸­è¯æ˜æœ‰æ•ˆã€‚å°†å¤§Kernelå·ç§¯çº³å…¥Res2Netçš„ä¸»è¦éšœç¢åœ¨äºå®ƒä»¬å¼•å…¥çš„è®¡ç®—å¼€é”€ï¼Œå› ä¸ºæ„å»ºå—é‡‡ç”¨äº†æ ‡å‡†å·ç§¯ã€‚åœ¨ä½œè€…çš„æ–¹æ³•ä¸­ï¼Œä½œè€…æå‡ºç”¨ Inverted Bottleneck Blockæ›¿ä»£æ ‡å‡†çš„3 Ã— 3å·ç§¯ï¼Œä»¥äº«å—å¤§Kernelå·ç§¯çš„å¥½å¤„ã€‚

#### MS-Block

åŸºäºå‰é¢çš„åˆ†æï¼Œå‚è€ƒè¯¥åšå®¢æå‡ºäº†ä¸€ä¸ªå¸¦æœ‰åˆ†å±‚ç‰¹å¾èåˆç­–ç•¥çš„å…¨æ–°Blockï¼Œç§°ä¸ºMS-Blockï¼Œä»¥å¢å¼ºå®æ—¶ç›®æ ‡æ£€æµ‹å™¨åœ¨æå–å¤šå°ºåº¦ç‰¹å¾æ—¶çš„èƒ½åŠ›ï¼ŒåŒæ—¶ä¿æŒå¿«é€Ÿçš„æ¨ç†é€Ÿåº¦ã€‚

MS-Blockçš„å…·ä½“ç»“æ„å¦‚å›¾2(c)æ‰€ç¤ºã€‚å‡è®¾æ˜¯è¾“å…¥ç‰¹å¾ã€‚é€šè¿‡1Ã—1å·ç§¯çš„è½¬æ¢åï¼ŒXçš„é€šé“ç»´åº¦å¢åŠ åˆ°n*Cã€‚ç„¶åï¼Œä½œè€…å°†Xåˆ†å‰²æˆnä¸ªä¸åŒçš„ç»„ï¼Œè¡¨ç¤ºä¸ºï¼Œå…¶ä¸­ã€‚ä¸ºäº†é™ä½è®¡ç®—æˆæœ¬ï¼Œä½œè€…é€‰æ‹©nä¸º3ã€‚

æ³¨æ„ï¼Œé™¤äº†ä¹‹å¤–ï¼Œæ¯ä¸ªå…¶ä»–ç»„éƒ½ç»è¿‡ä¸€ä¸ª Inverted Bottleneck Blockå±‚ï¼Œç”¨è¡¨ç¤ºï¼Œå…¶ä¸­kè¡¨ç¤ºKernel-Sizeï¼Œä»¥è·å¾—ã€‚çš„æ•°å­¦è¡¨ç¤ºå¦‚ä¸‹ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/be548cea35614fbab018018b6fb624c7.png)


æ ¹æ®è¿™ä¸ªå…¬å¼ï¼Œä½œè€…ä¸å°† Inverted Bottleneck Blockå±‚è¿æ¥åˆ°ï¼Œä½¿å…¶ä½œä¸ºè·¨é˜¶æ®µè¿æ¥ï¼Œå¹¶ä¿ç•™æ¥è‡ªå‰é¢å±‚çš„ä¿¡æ¯ã€‚æœ€åï¼Œä½œè€…å°†æ‰€æœ‰åˆ†å‰²è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶åº”ç”¨1Ã—1å·ç§¯æ¥åœ¨æ‰€æœ‰åˆ†å‰²ä¹‹é—´è¿›è¡Œäº¤äº’ï¼Œæ¯ä¸ªåˆ†å‰²éƒ½ç¼–ç ä¸åŒå°ºåº¦çš„ç‰¹å¾ã€‚å½“ç½‘ç»œåŠ æ·±æ—¶ï¼Œè¿™ä¸ª1Ã—1å·ç§¯ä¹Ÿç”¨äºè°ƒæ•´é€šé“æ•°ã€‚

#### Heterogeneous Kernel Selection Protocol
é™¤äº†æ„å»ºå—çš„è®¾è®¡å¤–ï¼Œä½œè€…è¿˜ä»å®è§‚è§’åº¦æ¢è®¨äº†å·ç§¯çš„ä½¿ç”¨ã€‚ä¹‹å‰çš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨åœ¨ä¸åŒçš„ç¼–ç å™¨é˜¶æ®µé‡‡ç”¨äº†åŒè´¨å·ç§¯ï¼ˆå³å…·æœ‰ç›¸åŒKernel-Sizeçš„å·ç§¯ï¼‰ï¼Œä½†ä½œè€…è®¤ä¸ºè¿™ä¸æ˜¯æå–å¤šå°ºåº¦è¯­ä¹‰ä¿¡æ¯çš„æœ€ä½³é€‰é¡¹ã€‚

åœ¨é‡‘å­—å¡”ç»“æ„ä¸­ï¼Œä»æ£€æµ‹å™¨çš„æµ…é˜¶æ®µæå–çš„é«˜åˆ†è¾¨ç‡ç‰¹å¾é€šå¸¸ç”¨äºæ•æ‰ç»†ç²’åº¦è¯­ä¹‰ï¼Œå°†ç”¨äºæ£€æµ‹å°ç›®æ ‡ã€‚ç›¸åï¼Œæ¥è‡ªç½‘ç»œè¾ƒæ·±é˜¶æ®µçš„ä½åˆ†è¾¨ç‡ç‰¹å¾ç”¨äºæ•æ‰é«˜çº§è¯­ä¹‰ï¼Œå°†ç”¨äºæ£€æµ‹å¤§ç›®æ ‡ã€‚å¦‚æœä½œè€…åœ¨æ‰€æœ‰é˜¶æ®µéƒ½é‡‡ç”¨ç»Ÿä¸€çš„å°Kernelå·ç§¯ï¼Œæ·±é˜¶æ®µçš„æœ‰æ•ˆæ„Ÿå—é‡ï¼ˆERFï¼‰å°†å—åˆ°é™åˆ¶ï¼Œå½±å“å¤§ç›®æ ‡çš„æ€§èƒ½ã€‚åœ¨æ¯ä¸ªé˜¶æ®µä¸­å¼•å…¥å¤§Kernelå·ç§¯å¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç„¶è€Œï¼Œå…·æœ‰å¤§çš„ERFçš„å¤§Kernelå¯ä»¥ç¼–ç æ›´å¹¿æ³›çš„åŒºåŸŸï¼Œè¿™å¢åŠ äº†åœ¨å°ç›®æ ‡å¤–éƒ¨åŒ…å«å™ªå£°ä¿¡æ¯çš„æ¦‚ç‡ï¼Œå¹¶ä¸”é™ä½äº†æ¨ç†é€Ÿåº¦ã€‚

åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œä½œè€…å»ºè®®åœ¨ä¸åŒé˜¶æ®µä¸­é‡‡ç”¨å¼‚æ„å·ç§¯ï¼Œä»¥å¸®åŠ©æ•è·æ›´ä¸°å¯Œçš„å¤šå°ºåº¦ç‰¹å¾ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ç¼–ç å™¨çš„ç¬¬ä¸€ä¸ªé˜¶æ®µä¸­ï¼Œä½œè€…é‡‡ç”¨æœ€å°Kernelå·ç§¯ï¼Œè€Œæœ€å¤§Kernelå·ç§¯ä½äºæœ€åä¸€ä¸ªé˜¶æ®µã€‚éšåï¼Œä½œè€…é€æ­¥å¢åŠ ä¸­é—´é˜¶æ®µçš„Kernel-Sizeï¼Œä½¿å…¶ä¸ç‰¹å¾åˆ†è¾¨ç‡çš„å¢åŠ ä¿æŒä¸€è‡´ã€‚è¿™ç§ç­–ç•¥å…è®¸æå–ç»†ç²’åº¦å’Œç²—ç²’åº¦çš„è¯­ä¹‰ä¿¡æ¯ï¼Œå¢å¼ºäº†ç¼–ç å™¨çš„å¤šå°ºåº¦ç‰¹å¾è¡¨ç¤ºèƒ½åŠ›ã€‚

æ­£å¦‚å›¾æ‰€ç¤ºï¼Œä½œè€…å°†kçš„å€¼åˆ†åˆ«åˆ†é…ç»™ç¼–ç å™¨ä¸­çš„æµ…é˜¶æ®µåˆ°æ·±é˜¶æ®µï¼Œå–å€¼ä¸º3ã€5ã€7å’Œ9ã€‚ä½œè€…å°†å…¶ç§°ä¸ºå¼‚æ„Kernelé€‰æ‹©ï¼ˆHKSï¼‰åè®®ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/98272afa671246d3aff8d03a56371527.png)


ä½œè€…çš„HKSåè®®èƒ½å¤Ÿåœ¨æ·±å±‚ä¸­æ‰©å¤§æ„Ÿå—é‡ï¼Œè€Œä¸ä¼šå¯¹æµ…å±‚äº§ç”Ÿä»»ä½•å…¶ä»–å½±å“ã€‚ç¬¬4èŠ‚çš„å›¾4æ”¯æŒäº†ä½œè€…çš„åˆ†æã€‚æ­¤å¤–ï¼ŒHKSä¸ä»…æœ‰åŠ©äºç¼–ç æ›´ä¸°å¯Œçš„å¤šå°ºåº¦ç‰¹å¾ï¼Œè¿˜ç¡®ä¿äº†é«˜æ•ˆçš„æ¨ç†ã€‚

å¦‚è¡¨1æ‰€ç¤ºï¼Œå°†å¤§Kernelå·ç§¯åº”ç”¨äºé«˜åˆ†è¾¨ç‡ç‰¹å¾ä¼šäº§ç”Ÿè¾ƒé«˜çš„è®¡ç®—å¼€é”€ã€‚ç„¶è€Œï¼Œä½œè€…çš„HKSåè®®åœ¨ä½åˆ†è¾¨ç‡ç‰¹å¾ä¸Šé‡‡ç”¨å¤§Kernelå·ç§¯ï¼Œä»è€Œä¸ä»…ä½¿ç”¨å¤§Kernelå·ç§¯ç›¸æ¯”ï¼Œå¤§å¤§é™ä½äº†è®¡ç®—æˆæœ¬ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/a28ea816451c491aa207b11d906ce285.png)


åœ¨å®è·µä¸­ï¼Œä½œè€…ç»éªŒæ€§åœ°å‘ç°ï¼Œé‡‡ç”¨HKSåè®®çš„YOLO-MSçš„æ¨ç†é€Ÿåº¦å‡ ä¹ä¸ä»…ä½¿ç”¨æ·±åº¦å¯åˆ†ç¦»çš„3 Ã— 3å·ç§¯ç›¸åŒã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/44e5893cec834594a6d8af727702cf26.png)

å¦‚å›¾æ‰€ç¤ºï¼Œä½œè€…æ¨¡å‹çš„Backboneç”±4ä¸ªé˜¶æ®µç»„æˆï¼Œæ¯ä¸ªé˜¶æ®µåé¢è·Ÿéš1ä¸ªæ­¥é•¿ä¸º2çš„3 Ã— 3å·ç§¯è¿›è¡Œä¸‹é‡‡æ ·ã€‚åœ¨ç¬¬3ä¸ªé˜¶æ®µåï¼Œä½œè€…æ·»åŠ äº†1ä¸ªSPPå—ï¼Œä¸RTMDetä¸­ä¸€æ ·ã€‚åœ¨ä½œè€…çš„ç¼–ç å™¨ä¸Šï¼Œä½œè€…ä½¿ç”¨PAFPNä½œä¸ºNeckæ¥æ„å»ºç‰¹å¾é‡‘å­—å¡”[31, 35]ã€‚å®ƒèåˆäº†ä»Backboneä¸åŒé˜¶æ®µæå–çš„å¤šå°ºåº¦ç‰¹å¾ã€‚Neckä¸­ä½¿ç”¨çš„åŸºæœ¬æ„å»ºå—ä¹Ÿæ˜¯ä½œè€…çš„MS-Blockï¼Œåœ¨å…¶ä¸­ä½¿ç”¨3 Ã— 3æ·±åº¦å¯åˆ†ç¦»å·ç§¯è¿›è¡Œå¿«é€Ÿæ¨ç†ã€‚

æ­¤å¤–ï¼Œä¸ºäº†åœ¨é€Ÿåº¦å’Œå‡†ç¡®æ€§ä¹‹é—´å–å¾—æ›´å¥½çš„å¹³è¡¡ï¼Œä½œè€…å°†Backboneä¸­å¤šçº§ç‰¹å¾çš„é€šé“æ·±åº¦å‡åŠã€‚ä½œè€…æä¾›äº†3ä¸ªä¸åŒå°ºåº¦çš„YOLO-MSå˜ä½“ï¼Œå³YOLO-MS-XSã€YOLO-MS-Så’ŒYOLO-MSã€‚ä¸åŒå°ºåº¦çš„YOLO-MSçš„è¯¦ç»†é…ç½®åˆ—åœ¨è¡¨2ä¸­ã€‚å¯¹äºYOLO-MSçš„å…¶ä»–éƒ¨åˆ†ï¼Œä½œè€…å°†å…¶ä¿æŒä¸RTMDetç›¸åŒã€‚


### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤º

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10. YOLOv11æ ¸å¿ƒæ”¹è¿›æºç è®²è§£

#### 10.1 dynamic_snake_conv.py

ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œåˆ†æå’Œè¯¦ç»†æ³¨é‡Šçš„ç»“æœï¼š

```python
import torch
import torch.nn as nn
from ..modules.conv import Conv

__all__ = ['DySnakeConv']

class DySnakeConv(nn.Module):
    def __init__(self, inc, ouc, k=3) -> None:
        super().__init__()
        
        # åˆå§‹åŒ–ä¸‰ä¸ªå·ç§¯å±‚
        self.conv_0 = Conv(inc, ouc, k)  # æ ‡å‡†å·ç§¯
        self.conv_x = DSConv(inc, ouc, 0, k)  # æ²¿xè½´çš„åŠ¨æ€è›‡å½¢å·ç§¯
        self.conv_y = DSConv(inc, ouc, 1, k)  # æ²¿yè½´çš„åŠ¨æ€è›‡å½¢å·ç§¯
    
    def forward(self, x):
        # å‰å‘ä¼ æ’­ï¼Œè¿æ¥ä¸‰ä¸ªå·ç§¯çš„è¾“å‡º
        return torch.cat([self.conv_0(x), self.conv_x(x), self.conv_y(x)], dim=1)

class DSConv(nn.Module):
    def __init__(self, in_ch, out_ch, morph, kernel_size=3, if_offset=True, extend_scope=1):
        """
        åŠ¨æ€è›‡å½¢å·ç§¯
        :param in_ch: è¾“å…¥é€šé“æ•°
        :param out_ch: è¾“å‡ºé€šé“æ•°
        :param kernel_size: å·ç§¯æ ¸å¤§å°
        :param extend_scope: æ‰©å±•èŒƒå›´ï¼ˆé»˜è®¤1ï¼‰
        :param morph: å·ç§¯æ ¸çš„å½¢æ€ï¼Œåˆ†ä¸ºæ²¿xè½´ï¼ˆ0ï¼‰å’Œyè½´ï¼ˆ1ï¼‰
        :param if_offset: æ˜¯å¦éœ€è¦å˜å½¢ï¼ŒFalseä¸ºæ ‡å‡†å·ç§¯
        """
        super(DSConv, self).__init__()
        # ç”¨äºå­¦ä¹ å¯å˜å½¢åç§»çš„å·ç§¯å±‚
        self.offset_conv = nn.Conv2d(in_ch, 2 * kernel_size, 3, padding=1)
        self.bn = nn.BatchNorm2d(2 * kernel_size)  # æ‰¹å½’ä¸€åŒ–
        self.kernel_size = kernel_size

        # å®šä¹‰æ²¿xè½´å’Œyè½´çš„åŠ¨æ€è›‡å½¢å·ç§¯
        self.dsc_conv_x = nn.Conv2d(
            in_ch,
            out_ch,
            kernel_size=(kernel_size, 1),
            stride=(kernel_size, 1),
            padding=0,
        )
        self.dsc_conv_y = nn.Conv2d(
            in_ch,
            out_ch,
            kernel_size=(1, kernel_size),
            stride=(1, kernel_size),
            padding=0,
        )

        self.gn = nn.GroupNorm(out_ch // 4, out_ch)  # ç»„å½’ä¸€åŒ–
        self.act = Conv.default_act  # é»˜è®¤æ¿€æ´»å‡½æ•°

        self.extend_scope = extend_scope
        self.morph = morph
        self.if_offset = if_offset

    def forward(self, f):
        # å‰å‘ä¼ æ’­
        offset = self.offset_conv(f)  # è®¡ç®—åç§»
        offset = self.bn(offset)  # æ‰¹å½’ä¸€åŒ–
        offset = torch.tanh(offset)  # å°†åç§»é™åˆ¶åœ¨[-1, 1]
        
        # è·å–è¾“å…¥ç‰¹å¾çš„å½¢çŠ¶
        input_shape = f.shape
        dsc = DSC(input_shape, self.kernel_size, self.extend_scope, self.morph)  # åˆ›å»ºDSCå¯¹è±¡
        deformed_feature = dsc.deform_conv(f, offset, self.if_offset)  # è¿›è¡Œå¯å˜å½¢å·ç§¯
        
        # æ ¹æ®å½¢æ€é€‰æ‹©ç›¸åº”çš„å·ç§¯æ“ä½œ
        if self.morph == 0:
            x = self.dsc_conv_x(deformed_feature.type(f.dtype))
        else:
            x = self.dsc_conv_y(deformed_feature.type(f.dtype))
        
        x = self.gn(x)  # ç»„å½’ä¸€åŒ–
        x = self.act(x)  # æ¿€æ´»å‡½æ•°
        return x

# åŠ¨æ€è›‡å½¢å·ç§¯çš„æ ¸å¿ƒéƒ¨åˆ†
class DSC(object):
    def __init__(self, input_shape, kernel_size, extend_scope, morph):
        self.num_points = kernel_size  # å·ç§¯æ ¸çš„ç‚¹æ•°
        self.width = input_shape[2]  # è¾“å…¥ç‰¹å¾å›¾çš„å®½åº¦
        self.height = input_shape[3]  # è¾“å…¥ç‰¹å¾å›¾çš„é«˜åº¦
        self.morph = morph  # å·ç§¯æ ¸å½¢æ€
        self.extend_scope = extend_scope  # åç§»èŒƒå›´

        # å®šä¹‰ç‰¹å¾å›¾çš„å½¢çŠ¶
        self.num_batch = input_shape[0]  # æ‰¹é‡å¤§å°
        self.num_channels = input_shape[1]  # é€šé“æ•°

    def _coordinate_map_3D(self, offset, if_offset):
        # è®¡ç®—3Dåæ ‡å›¾
        device = offset.device
        y_offset, x_offset = torch.split(offset, self.num_points, dim=1)  # åˆ†ç¦»yå’Œxçš„åç§»

        # ç”Ÿæˆyå’Œxçš„ä¸­å¿ƒåæ ‡
        y_center = torch.arange(0, self.width).repeat([self.height]).reshape(self.height, self.width).permute(1, 0).reshape([-1, self.width, self.height]).unsqueeze(0)
        x_center = torch.arange(0, self.height).repeat([self.width]).reshape(self.width, self.height).permute(0, 1).reshape([-1, self.width, self.height]).unsqueeze(0)

        # æ ¹æ®å½¢æ€åˆå§‹åŒ–å·ç§¯æ ¸
        if self.morph == 0:
            y = torch.linspace(0, 0, 1)
            x = torch.linspace(-int(self.num_points // 2), int(self.num_points // 2), int(self.num_points))
        else:
            y = torch.linspace(-int(self.num_points // 2), int(self.num_points // 2), int(self.num_points))
            x = torch.linspace(0, 0, 1)

        y, x = torch.meshgrid(y, x)  # ç”Ÿæˆç½‘æ ¼
        y_spread = y.reshape(-1, 1)
        x_spread = x.reshape(-1, 1)

        # ç”Ÿæˆæ–°çš„yå’Œxåæ ‡
        y_grid = y_spread.repeat([1, self.width * self.height]).reshape([self.num_points, self.width, self.height]).unsqueeze(0)
        x_grid = x_spread.repeat([1, self.width * self.height]).reshape([self.num_points, self.width, self.height]).unsqueeze(0)

        y_new = y_center + y_grid
        x_new = x_center + x_grid

        # å¤„ç†åç§»
        if if_offset:
            y_offset_new = y_offset.detach().clone()
            center = int(self.num_points // 2)
            y_offset_new[center] = 0
            for index in range(1, center):
                y_offset_new[center + index] = (y_offset_new[center + index - 1] + y_offset[center + index])
                y_offset_new[center - index] = (y_offset_new[center - index + 1] + y_offset[center - index])
            y_new = y_new.add(y_offset_new.mul(self.extend_scope))

        # è¿”å›æ–°çš„yå’Œxåæ ‡
        return y_new.reshape([self.num_batch, self.num_points, 1, self.width, self.height]).permute(0, 3, 1, 4, 2), x_new.reshape([self.num_batch, self.num_points, 1, self.width, self.height]).permute(0, 3, 1, 4, 2)

    def _bilinear_interpolate_3D(self, input_feature, y, x):
        # è¿›è¡Œ3DåŒçº¿æ€§æ’å€¼
        device = input_feature.device
        y = y.reshape([-1]).float()
        x = x.reshape([-1]).float()

        # è®¡ç®—æ’å€¼æ‰€éœ€çš„åæ ‡
        y0 = torch.floor(y).int()
        y1 = y0 + 1
        x0 = torch.floor(x).int()
        x1 = x0 + 1

        # é™åˆ¶åæ ‡èŒƒå›´
        max_y = self.width - 1
        max_x = self.height - 1
        y0 = torch.clamp(y0, 0, max_y)
        y1 = torch.clamp(y1, 0, max_y)
        x0 = torch.clamp(x0, 0, max_x)
        x1 = torch.clamp(x1, 0, max_x)

        # è·å–8ä¸ªç½‘æ ¼å€¼
        input_feature_flat = input_feature.flatten().reshape(self.num_batch, self.num_channels, self.width, self.height).permute(0, 2, 3, 1).reshape(-1, self.num_channels)
        dimension = self.height * self.width
        base = torch.arange(self.num_batch) * dimension
        base = base.reshape([-1, 1]).float()

        # è®¡ç®—æ’å€¼
        base_y0 = base + y0 * self.height
        base_y1 = base + y1 * self.height
        index_a0 = base_y0 - base + x0
        index_c0 = base_y0 - base + x1
        index_a1 = base_y1 - base + x0
        index_c1 = base_y1 - base + x1

        # è·å–8ä¸ªç½‘æ ¼å€¼
        value_a0 = input_feature_flat[index_a0.type(torch.int64)].to(device)
        value_c0 = input_feature_flat[index_c0.type(torch.int64)].to(device)
        value_a1 = input_feature_flat[index_a1.type(torch.int64)].to(device)
        value_c1 = input_feature_flat[index_c1.type(torch.int64)].to(device)

        # è®¡ç®—æœ€ç»ˆè¾“å‡º
        outputs = (value_a0 * ((y1.float() - y) * (x1.float() - x).unsqueeze(-1).to(device)) +
                   value_c0 * ((y1.float() - y) * (x - x0.float()).unsqueeze(-1).to(device)) +
                   value_a1 * ((y - y0.float()) * (x1.float() - x).unsqueeze(-1).to(device)) +
                   value_c1 * ((y - y0.float()) * (x - x0.float()).unsqueeze(-1).to(device)))

        # æ ¹æ®å½¢æ€è°ƒæ•´è¾“å‡ºå½¢çŠ¶
        if self.morph == 0:
            outputs = outputs.reshape([self.num_batch, self.num_points * self.width, 1 * self.height, self.num_channels]).permute(0, 3, 1, 2)
        else:
            outputs = outputs.reshape([self.num_batch, 1 * self.width, self.num_points * self.height, self.num_channels]).permute(0, 3, 1, 2)
        return outputs

    def deform_conv(self, input, offset, if_offset):
        # è¿›è¡Œå¯å˜å½¢å·ç§¯
        y, x = self._coordinate_map_3D(offset, if_offset)  # è®¡ç®—åæ ‡å›¾
        deformed_feature = self._bilinear_interpolate_3D(input, y, x)  # è¿›è¡Œæ’å€¼
        return deformed_feature  # è¿”å›å˜å½¢åçš„ç‰¹å¾å›¾
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†åˆ†æ
1. **DySnakeConv** ç±»æ˜¯åŠ¨æ€è›‡å½¢å·ç§¯çš„ä¸»è¦æ¨¡å—ï¼ŒåŒ…å«ä¸‰ä¸ªå·ç§¯å±‚ï¼šæ ‡å‡†å·ç§¯å’Œä¸¤ä¸ªåŠ¨æ€è›‡å½¢å·ç§¯ï¼ˆåˆ†åˆ«æ²¿xè½´å’Œyè½´ï¼‰ã€‚
2. **DSConv** ç±»å®ç°äº†åŠ¨æ€è›‡å½¢å·ç§¯çš„å…·ä½“é€»è¾‘ï¼ŒåŒ…æ‹¬åç§»å­¦ä¹ ã€åæ ‡è®¡ç®—å’ŒåŒçº¿æ€§æ’å€¼ã€‚
3. **DSC** ç±»è´Ÿè´£ç”Ÿæˆ3Dåæ ‡å›¾å’Œæ‰§è¡ŒåŒçº¿æ€§æ’å€¼ï¼Œå®Œæˆè¾“å…¥ç‰¹å¾å›¾çš„å˜å½¢å¤„ç†ã€‚

### å…³é”®åŠŸèƒ½
- **åŠ¨æ€å·ç§¯**ï¼šé€šè¿‡å­¦ä¹ åç§»é‡æ¥å®ç°ç‰¹å¾å›¾çš„åŠ¨æ€å˜å½¢ã€‚
- **åŒçº¿æ€§æ’å€¼**ï¼šåœ¨å˜å½¢è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡åŒçº¿æ€§æ’å€¼æ–¹æ³•æ¥è·å–æ–°çš„ç‰¹å¾å›¾å€¼ã€‚
- **çµæ´»æ€§**ï¼šå¯ä»¥æ ¹æ®ä¸åŒçš„å·ç§¯æ ¸å½¢æ€ï¼ˆxè½´æˆ–yè½´ï¼‰æ¥é€‰æ‹©ç›¸åº”çš„å·ç§¯æ“ä½œã€‚

è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåŠ¨æ€è›‡å½¢å·ç§¯ï¼ˆDynamic Snake Convolutionï¼‰æ¨¡å—ï¼Œä¸»è¦ç”±ä¸¤ä¸ªç±»æ„æˆï¼š`DySnakeConv` å’Œ `DSConv`ï¼Œä»¥åŠä¸€ä¸ªè¾…åŠ©ç±» `DSC`ã€‚è¿™äº›ç±»ç»“åˆäº†æ ‡å‡†å·ç§¯å’Œå¯å˜å½¢å·ç§¯çš„æ€æƒ³ï¼Œæ—¨åœ¨é€šè¿‡åŠ¨æ€è°ƒæ•´å·ç§¯æ ¸çš„ä½ç½®æ¥æé«˜ç‰¹å¾æå–çš„èƒ½åŠ›ã€‚

é¦–å…ˆï¼Œ`DySnakeConv` ç±»æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å—ï¼Œç»§æ‰¿è‡ª `nn.Module`ã€‚åœ¨å…¶æ„é€ å‡½æ•°ä¸­ï¼Œåˆå§‹åŒ–äº†ä¸‰ä¸ªå·ç§¯å±‚ï¼š`conv_0` æ˜¯ä¸€ä¸ªæ ‡å‡†å·ç§¯ï¼Œ`conv_x` å’Œ `conv_y` æ˜¯åŠ¨æ€è›‡å½¢å·ç§¯ï¼Œåˆ†åˆ«æ²¿ç€ x è½´å’Œ y è½´è¿›è¡Œæ“ä½œã€‚`forward` æ–¹æ³•å°†è¾“å…¥æ•°æ® `x` é€šè¿‡è¿™ä¸‰ä¸ªå·ç§¯å±‚å¤„ç†åï¼Œå°†ç»“æœåœ¨é€šé“ç»´åº¦ä¸Šæ‹¼æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ›´ä¸°å¯Œçš„ç‰¹å¾è¡¨ç¤ºã€‚

æ¥ä¸‹æ¥ï¼Œ`DSConv` ç±»å®ç°äº†åŠ¨æ€è›‡å½¢å·ç§¯çš„å…·ä½“é€»è¾‘ã€‚æ„é€ å‡½æ•°ä¸­ï¼Œå®šä¹‰äº†å¤šä¸ªå·ç§¯å±‚å’Œå‚æ•°ï¼ŒåŒ…æ‹¬ç”¨äºå­¦ä¹ åç§»é‡çš„å·ç§¯å±‚ `offset_conv`ï¼Œä»¥åŠä¸¤ä¸ªæ–¹å‘çš„å·ç§¯å±‚ `dsc_conv_x` å’Œ `dsc_conv_y`ã€‚æ­¤å¤–ï¼Œè¿˜åŒ…æ‹¬æ‰¹å½’ä¸€åŒ–å±‚å’Œæ¿€æ´»å‡½æ•°ã€‚`forward` æ–¹æ³•ä¸­ï¼Œé¦–å…ˆé€šè¿‡ `offset_conv` è®¡ç®—å‡ºåç§»é‡ï¼Œç„¶åä½¿ç”¨ `DSC` ç±»ç”Ÿæˆçš„åæ ‡å›¾æ¥è¿›è¡Œå¯å˜å½¢å·ç§¯æ“ä½œï¼Œæœ€åæ ¹æ®ä¸åŒçš„å½¢æ€ï¼ˆx è½´æˆ– y è½´ï¼‰è¿”å›å¤„ç†åçš„ç‰¹å¾ã€‚

`DSC` ç±»æ˜¯ä¸€ä¸ªè¾…åŠ©ç±»ï¼Œè´Ÿè´£ç”Ÿæˆåæ ‡å›¾å’Œè¿›è¡ŒåŒçº¿æ€§æ’å€¼ã€‚å®ƒçš„æ„é€ å‡½æ•°æ¥æ”¶è¾“å…¥å½¢çŠ¶ã€å·ç§¯æ ¸å¤§å°ã€æ‰©å±•èŒƒå›´å’Œå½¢æ€å‚æ•°ã€‚`_coordinate_map_3D` æ–¹æ³•æ ¹æ®åç§»é‡ç”Ÿæˆæ–°çš„åæ ‡å›¾ï¼Œ`_bilinear_interpolate_3D` æ–¹æ³•åˆ™æ ¹æ®ç”Ÿæˆçš„åæ ‡å›¾å¯¹è¾“å…¥ç‰¹å¾è¿›è¡ŒåŒçº¿æ€§æ’å€¼ï¼Œå¾—åˆ°å˜å½¢åçš„ç‰¹å¾å›¾ã€‚`deform_conv` æ–¹æ³•æ˜¯å¯¹å¤–æ¥å£ï¼Œè°ƒç”¨å‰é¢çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå®Œæˆä»è¾“å…¥ç‰¹å¾åˆ°å˜å½¢ç‰¹å¾çš„è½¬æ¢ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªçµæ´»çš„å·ç§¯æ¨¡å—ï¼Œé€šè¿‡åŠ¨æ€è°ƒæ•´å·ç§¯æ ¸çš„ä½ç½®æ¥é€‚åº”è¾“å…¥ç‰¹å¾çš„å½¢çŠ¶ï¼Œä»è€Œæé«˜äº†å·ç§¯ç¥ç»ç½‘ç»œåœ¨å¤„ç†å¤æ‚æ•°æ®æ—¶çš„è¡¨ç°ã€‚

#### 10.2 UniRepLKNet.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å¹¶æ·»åŠ è¯¦ç»†ä¸­æ–‡æ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import torch
import torch.nn as nn
import torch.nn.functional as F

class GRNwithNHWC(nn.Module):
    """ 
    GRN (Global Response Normalization) å±‚
    è¯¥å±‚ç”¨äºå¯¹è¾“å…¥è¿›è¡Œå…¨å±€å“åº”å½’ä¸€åŒ–ï¼Œå‡è®¾è¾“å…¥æ ¼å¼ä¸º (N, H, W, C)
    """
    def __init__(self, dim, use_bias=True):
        super().__init__()
        self.use_bias = use_bias
        # gamma å’Œ beta æ˜¯å¯å­¦ä¹ çš„å‚æ•°
        self.gamma = nn.Parameter(torch.zeros(1, 1, 1, dim))
        if self.use_bias:
            self.beta = nn.Parameter(torch.zeros(1, 1, 1, dim))

    def forward(self, x):
        # è®¡ç®—è¾“å…¥çš„ L2 èŒƒæ•°
        Gx = torch.norm(x, p=2, dim=(1, 2), keepdim=True)
        # è®¡ç®—å½’ä¸€åŒ–å› å­
        Nx = Gx / (Gx.mean(dim=-1, keepdim=True) + 1e-6)
        if self.use_bias:
            return (self.gamma * Nx + 1) * x + self.beta
        else:
            return (self.gamma * Nx + 1) * x

class UniRepLKNetBlock(nn.Module):
    """
    UniRepLKNet çš„åŸºæœ¬æ¨¡å—
    åŒ…å«æ·±åº¦å·ç§¯ã€å½’ä¸€åŒ–ã€æ¿€æ´»å‡½æ•°å’Œ Squeeze-and-Excitation (SE) å—
    """
    def __init__(self, dim, kernel_size, drop_path=0., deploy=False):
        super().__init__()
        # æ·±åº¦å·ç§¯å±‚
        self.dwconv = nn.Conv2d(dim, dim, kernel_size=kernel_size, stride=1, padding=kernel_size // 2, groups=dim)
        # å½’ä¸€åŒ–å±‚
        self.norm = nn.BatchNorm2d(dim)
        # Squeeze-and-Excitation å—
        self.se = SEBlock(dim, dim // 4)
        # å‰é¦ˆç½‘ç»œ
        self.pwconv1 = nn.Linear(dim, dim * 4)
        self.pwconv2 = nn.Linear(dim * 4, dim)

    def forward(self, x):
        # æ·±åº¦å·ç§¯ + å½’ä¸€åŒ– + SE å—
        y = self.se(self.norm(self.dwconv(x)))
        # å‰é¦ˆç½‘ç»œ
        y = self.pwconv2(F.gelu(self.pwconv1(y)))
        return y + x  # æ®‹å·®è¿æ¥

class UniRepLKNet(nn.Module):
    """
    UniRepLKNet æ¨¡å‹
    åŒ…å«å¤šä¸ª UniRepLKNetBlock ç»„æˆçš„é˜¶æ®µ
    """
    def __init__(self, in_chans=3, num_classes=1000, depths=(3, 3, 27, 3), dims=(96, 192, 384, 768)):
        super().__init__()
        self.stages = nn.ModuleList()
        for i in range(len(depths)):
            # æ¯ä¸ªé˜¶æ®µåŒ…å«å¤šä¸ª UniRepLKNetBlock
            stage = nn.Sequential(*[UniRepLKNetBlock(dim=dims[i], kernel_size=3) for _ in range(depths[i])])
            self.stages.append(stage)

    def forward(self, x):
        for stage in self.stages:
            x = stage(x)  # é€é˜¶æ®µå‰å‘ä¼ æ’­
        return x

# åˆ›å»ºæ¨¡å‹å®ä¾‹å¹¶è¿›è¡Œå‰å‘ä¼ æ’­
if __name__ == '__main__':
    inputs = torch.randn((1, 3, 640, 640))  # éšæœºè¾“å…¥
    model = UniRepLKNet()  # å®ä¾‹åŒ–æ¨¡å‹
    res = model(inputs)  # å‰å‘ä¼ æ’­
    print(res.shape)  # è¾“å‡ºç»“æœçš„å½¢çŠ¶
```

### ä»£ç è¯´æ˜ï¼š
1. **GRNwithNHWC**: å®ç°äº†å…¨å±€å“åº”å½’ä¸€åŒ–å±‚ï¼Œç”¨äºè°ƒæ•´è¾“å…¥ç‰¹å¾çš„å“åº”ã€‚
2. **UniRepLKNetBlock**: å®šä¹‰äº†æ¨¡å‹çš„åŸºæœ¬æ„å»ºå—ï¼ŒåŒ…å«æ·±åº¦å·ç§¯ã€å½’ä¸€åŒ–ã€æ¿€æ´»å‡½æ•°å’Œ Squeeze-and-Excitation å—ï¼Œä½¿ç”¨æ®‹å·®è¿æ¥æ¥å¢å¼ºä¿¡æ¯æµåŠ¨ã€‚
3. **UniRepLKNet**: æ•´ä¸ªæ¨¡å‹ç”±å¤šä¸ª `UniRepLKNetBlock` ç»„æˆï¼ŒæŒ‰ç…§ç»™å®šçš„æ·±åº¦å’Œç»´åº¦è¿›è¡Œå †å ï¼Œå½¢æˆä¸åŒçš„é˜¶æ®µã€‚
4. **ä¸»ç¨‹åº**: åˆ›å»ºæ¨¡å‹å®ä¾‹å¹¶å¯¹éšæœºè¾“å…¥è¿›è¡Œå‰å‘ä¼ æ’­ï¼Œè¾“å‡ºç»“æœçš„å½¢çŠ¶ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `UniRepLKNet.py` å®ç°äº†ä¸€ä¸ªåä¸º UniRepLKNet çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¸»è¦ç”¨äºéŸ³é¢‘ã€è§†é¢‘ã€ç‚¹äº‘ã€æ—¶é—´åºåˆ—å’Œå›¾åƒè¯†åˆ«ã€‚è¯¥æ¨¡å‹åŸºäºå¤šä¸ªç°æœ‰çš„æ·±åº¦å­¦ä¹ æ¡†æ¶å’Œæ–¹æ³•ï¼ŒåŒ…æ‹¬ RepLKNetã€ConvNeXtã€timmã€DINO å’Œ DeiTã€‚æ–‡ä»¶ä¸­åŒ…å«äº†å¤šä¸ªç±»å’Œå‡½æ•°ï¼Œæ„æˆäº†æ¨¡å‹çš„æ ¸å¿ƒç»“æ„ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬ PyTorch åŠå…¶ç›¸å…³æ¨¡å—ã€‚æ¥ç€ï¼Œå®šä¹‰äº†ä¸€äº›åŸºç¡€ç»„ä»¶ï¼Œå¦‚ GRNï¼ˆå…¨å±€å“åº”å½’ä¸€åŒ–ï¼‰å±‚ã€NCHW å’Œ NHWC æ ¼å¼çš„è½¬æ¢å±‚ã€‚è¿™äº›ç»„ä»¶åœ¨æ¨¡å‹çš„ä¸åŒéƒ¨åˆ†ä¸­è¢«é‡å¤ä½¿ç”¨ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¤ç”¨æ€§ã€‚

`get_conv2d` å‡½æ•°ç”¨äºæ ¹æ®è¾“å…¥å‚æ•°å†³å®šä½¿ç”¨å“ªç§å·ç§¯å®ç°ï¼Œæ”¯æŒåŸç”Ÿå·ç§¯å’Œé«˜æ•ˆçš„ iGEMM å¤§æ ¸å·ç§¯å®ç°ã€‚`get_bn` å‡½æ•°åˆ™æ ¹æ®æ˜¯å¦ä½¿ç”¨åŒæ­¥æ‰¹å½’ä¸€åŒ–è¿”å›ç›¸åº”çš„æ‰¹å½’ä¸€åŒ–å±‚ã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº† Squeeze-and-Excitation Blockï¼ˆSEBlockï¼‰ï¼Œå®ƒé€šè¿‡è‡ªé€‚åº”å¹³å‡æ± åŒ–å’Œä¸¤ä¸ªå·ç§¯å±‚æ¥è°ƒæ•´é€šé“çš„æƒé‡ï¼Œä»è€Œå¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚è¿˜æœ‰ä¸€äº›å‡½æ•°ç”¨äºåˆå¹¶å·ç§¯å±‚çš„æ‰¹å½’ä¸€åŒ–å‚æ•°ï¼Œä»¥åŠå°†è†¨èƒ€å·ç§¯è½¬æ¢ä¸ºéè†¨èƒ€å·ç§¯ã€‚

`DilatedReparamBlock` ç±»å®ç°äº†è†¨èƒ€é‡å‚æ•°åŒ–å—ï¼Œå…è®¸åœ¨ä¸åŒçš„å·ç§¯æ ¸å¤§å°å’Œè†¨èƒ€ç‡ä¸‹è¿›è¡Œå·ç§¯æ“ä½œã€‚è¿™ä¸ªç±»çš„è®¾è®¡ä½¿å¾—æ¨¡å‹åœ¨æ¨ç†æ—¶èƒ½å¤Ÿé«˜æ•ˆåœ°ä½¿ç”¨å¤§æ ¸å·ç§¯ã€‚

`UniRepLKNetBlock` ç±»æ˜¯æ¨¡å‹çš„åŸºæœ¬æ„å»ºå—ï¼ŒåŒ…å«äº†å·ç§¯å±‚ã€å½’ä¸€åŒ–å±‚ã€SEBlock å’Œå‰é¦ˆç½‘ç»œã€‚å®ƒæ”¯æŒä¸åŒçš„é…ç½®ï¼Œå¦‚æ˜¯å¦å¯ç”¨éšæœºæ·±åº¦ã€æ˜¯å¦ä½¿ç”¨å±‚ç¼©æ”¾ç­‰ã€‚

`UniRepLKNet` ç±»åˆ™æ˜¯æ•´ä¸ªæ¨¡å‹çš„ä¸»ä½“ï¼Œè´Ÿè´£æ„å»ºä¸åŒçš„å±‚å’Œå—ï¼Œå¹¶å®šä¹‰å‰å‘ä¼ æ’­çš„é€»è¾‘ã€‚æ¨¡å‹çš„åˆå§‹åŒ–å‚æ•°åŒ…æ‹¬è¾“å…¥é€šé“æ•°ã€ç±»åˆ«æ•°ã€æ¯ä¸ªé˜¶æ®µçš„æ·±åº¦å’Œç‰¹å¾ç»´åº¦ç­‰ã€‚æ¨¡å‹æ”¯æŒå¤šç§è¾“å‡ºæ¨¡å¼ï¼Œå¦‚è¿”å›ç‰¹å¾æˆ–åˆ†ç±»ç»“æœã€‚

æœ€åï¼Œæ–‡ä»¶æä¾›äº†ä¸€äº›å‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸åŒé…ç½®çš„ UniRepLKNet æ¨¡å‹å®ä¾‹ï¼Œå¹¶åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚ä¸»ç¨‹åºéƒ¨åˆ†æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºæ¨¡å‹å®ä¾‹å¹¶è¿›è¡Œæ¨ç†ã€‚

æ•´ä½“è€Œè¨€ï¼Œ`UniRepLKNet.py` æ–‡ä»¶é€šè¿‡æ¨¡å—åŒ–çš„è®¾è®¡å’Œçµæ´»çš„å‚æ•°é…ç½®ï¼Œæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ¡†æ¶ï¼Œé€‚ç”¨äºå¤šç§è§†è§‰å’Œéè§†è§‰ä»»åŠ¡ã€‚

#### 10.3 val.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
class DetectionValidator(BaseValidator):
    """
    æ‰©å±•è‡ª BaseValidator ç±»çš„æ£€æµ‹æ¨¡å‹éªŒè¯å™¨ã€‚
    """

    def __init__(self, dataloader=None, save_dir=None, pbar=None, args=None, _callbacks=None):
        """åˆå§‹åŒ–æ£€æµ‹æ¨¡å‹æ‰€éœ€çš„å˜é‡å’Œè®¾ç½®ã€‚"""
        super().__init__(dataloader, save_dir, pbar, args, _callbacks)
        self.nt_per_class = None  # æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡æ•°é‡
        self.is_coco = False  # æ˜¯å¦ä¸º COCO æ•°æ®é›†
        self.class_map = None  # ç±»åˆ«æ˜ å°„
        self.args.task = "detect"  # ä»»åŠ¡ç±»å‹è®¾ç½®ä¸ºæ£€æµ‹
        self.metrics = DetMetrics(save_dir=self.save_dir, on_plot=self.on_plot)  # åˆå§‹åŒ–æ£€æµ‹æŒ‡æ ‡
        self.iouv = torch.linspace(0.5, 0.95, 10)  # mAP@0.5:0.95 çš„ IoU å‘é‡
        self.niou = self.iouv.numel()  # IoU çš„æ•°é‡
        self.lb = []  # ç”¨äºè‡ªåŠ¨æ ‡è®°

    def preprocess(self, batch):
        """å¯¹ YOLO è®­ç»ƒçš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ã€‚"""
        # å°†å›¾åƒç§»åŠ¨åˆ°è®¾å¤‡ä¸Šå¹¶è¿›è¡Œå½’ä¸€åŒ–å¤„ç†
        batch["img"] = batch["img"].to(self.device, non_blocking=True)
        batch["img"] = (batch["img"].half() if self.args.half else batch["img"].float()) / 255
        for k in ["batch_idx", "cls", "bboxes"]:
            batch[k] = batch[k].to(self.device)

        # å¦‚æœéœ€è¦ä¿å­˜æ··åˆæ•°æ®ï¼Œè¿›è¡Œç›¸åº”å¤„ç†
        if self.args.save_hybrid:
            height, width = batch["img"].shape[2:]
            nb = len(batch["img"])
            bboxes = batch["bboxes"] * torch.tensor((width, height, width, height), device=self.device)
            self.lb = (
                [
                    torch.cat([batch["cls"][batch["batch_idx"] == i], bboxes[batch["batch_idx"] == i]], dim=-1)
                    for i in range(nb)
                ]
                if self.args.save_hybrid
                else []
            )  # ç”¨äºè‡ªåŠ¨æ ‡è®°

        return batch

    def postprocess(self, preds):
        """å¯¹é¢„æµ‹è¾“å‡ºåº”ç”¨éæå¤§å€¼æŠ‘åˆ¶ã€‚"""
        return ops.non_max_suppression(
            preds,
            self.args.conf,
            self.args.iou,
            labels=self.lb,
            multi_label=True,
            agnostic=self.args.single_cls,
            max_det=self.args.max_det,
        )

    def update_metrics(self, preds, batch):
        """æ›´æ–°æŒ‡æ ‡ç»Ÿè®¡ä¿¡æ¯ã€‚"""
        for si, pred in enumerate(preds):
            self.seen += 1  # è®°å½•å·²å¤„ç†çš„å›¾åƒæ•°é‡
            npr = len(pred)  # å½“å‰é¢„æµ‹çš„æ•°é‡
            stat = dict(
                conf=torch.zeros(0, device=self.device),
                pred_cls=torch.zeros(0, device=self.device),
                tp=torch.zeros(npr, self.niou, dtype=torch.bool, device=self.device),
            )
            pbatch = self._prepare_batch(si, batch)  # å‡†å¤‡å½“å‰æ‰¹æ¬¡çš„æ ‡ç­¾
            cls, bbox = pbatch.pop("cls"), pbatch.pop("bbox")  # è·å–çœŸå®æ ‡ç­¾
            nl = len(cls)  # çœŸå®æ ‡ç­¾æ•°é‡
            stat["target_cls"] = cls  # è®°å½•çœŸå®ç±»åˆ«

            if npr == 0:  # å¦‚æœæ²¡æœ‰é¢„æµ‹
                if nl:
                    for k in self.stats.keys():
                        self.stats[k].append(stat[k])
                continue

            # å¤„ç†é¢„æµ‹
            if self.args.single_cls:
                pred[:, 5] = 0  # å¦‚æœæ˜¯å•ç±»æ£€æµ‹ï¼Œè®¾ç½®ç±»åˆ«ä¸º0
            predn = self._prepare_pred(pred, pbatch)  # å‡†å¤‡é¢„æµ‹æ•°æ®
            stat["conf"] = predn[:, 4]  # ç½®ä¿¡åº¦
            stat["pred_cls"] = predn[:, 5]  # é¢„æµ‹ç±»åˆ«

            # è¯„ä¼°
            if nl:
                stat["tp"] = self._process_batch(predn, bbox, cls)  # è®¡ç®—çœŸæ­£ä¾‹
            for k in self.stats.keys():
                self.stats[k].append(stat[k])  # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯

    def get_stats(self):
        """è¿”å›æŒ‡æ ‡ç»Ÿè®¡ä¿¡æ¯å’Œç»“æœå­—å…¸ã€‚"""
        stats = {k: torch.cat(v, 0).cpu().numpy() for k, v in self.stats.items()}  # è½¬æ¢ä¸º numpy æ•°ç»„
        if len(stats) and stats["tp"].any():
            self.metrics.process(**stats)  # å¤„ç†æŒ‡æ ‡
        self.nt_per_class = np.bincount(
            stats["target_cls"].astype(int), minlength=self.nc
        )  # è®¡ç®—æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡æ•°é‡
        return self.metrics.results_dict  # è¿”å›ç»“æœå­—å…¸
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **DetectionValidator ç±»**ï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºæ£€æµ‹æ¨¡å‹éªŒè¯çš„ç±»ï¼Œç»§æ‰¿è‡ª `BaseValidator`ï¼ŒåŒ…å«äº†åˆå§‹åŒ–ã€é¢„å¤„ç†ã€åå¤„ç†ã€æŒ‡æ ‡æ›´æ–°ç­‰å¤šä¸ªæ–¹æ³•ã€‚
2. **åˆå§‹åŒ–æ–¹æ³•**ï¼šè®¾ç½®äº†ä¸€äº›å¿…è¦çš„å˜é‡å’Œå‚æ•°ï¼ŒåŒ…æ‹¬ä»»åŠ¡ç±»å‹ã€æŒ‡æ ‡å¯¹è±¡ç­‰ã€‚
3. **é¢„å¤„ç†æ–¹æ³•**ï¼šå¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬è®¾å¤‡è½¬ç§»å’Œå½’ä¸€åŒ–ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œæ··åˆæ•°æ®çš„å¤„ç†ã€‚
4. **åå¤„ç†æ–¹æ³•**ï¼šåº”ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼Œè¿‡æ»¤æ‰å†—ä½™çš„é¢„æµ‹æ¡†ã€‚
5. **æ›´æ–°æŒ‡æ ‡æ–¹æ³•**ï¼šåœ¨æ¯ä¸ªæ‰¹æ¬¡ä¸­æ›´æ–°æ£€æµ‹æŒ‡æ ‡ï¼ŒåŒ…æ‹¬è®¡ç®—çœŸæ­£ä¾‹ã€æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚
6. **è·å–ç»Ÿè®¡ä¿¡æ¯æ–¹æ³•**ï¼šè¿”å›æ£€æµ‹ç»“æœçš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè®¡ç®—æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡æ•°é‡ã€‚

è¿™äº›æ ¸å¿ƒéƒ¨åˆ†æ„æˆäº†æ£€æµ‹æ¨¡å‹éªŒè¯çš„åŸºç¡€ï¼Œç¡®ä¿äº†æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„æ€§èƒ½è¯„ä¼°ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `val.py` æ˜¯ä¸€ä¸ªç”¨äºéªŒè¯ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼ˆå¦‚ YOLOï¼‰çš„ç±» `DetectionValidator` çš„å®ç°ã€‚è¯¥ç±»ç»§æ‰¿è‡ª `BaseValidator`ï¼Œå¹¶æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥å¤„ç†æ•°æ®ã€è®¡ç®—æŒ‡æ ‡å’Œè¾“å‡ºç»“æœã€‚

åœ¨åˆå§‹åŒ–æ—¶ï¼Œ`DetectionValidator` æ¥æ”¶ä¸€äº›å‚æ•°ï¼Œå¦‚æ•°æ®åŠ è½½å™¨ã€ä¿å­˜ç›®å½•ã€è¿›åº¦æ¡ã€å‚æ•°å­—å…¸ç­‰ã€‚å®ƒè®¾ç½®äº†ä¸€äº›ç”¨äºéªŒè¯çš„å˜é‡ï¼Œä¾‹å¦‚ `nt_per_class`ï¼ˆæ¯ä¸ªç±»åˆ«çš„ç›®æ ‡æ•°é‡ï¼‰ã€`is_coco`ï¼ˆæ˜¯å¦ä½¿ç”¨ COCO æ•°æ®é›†ï¼‰ã€`class_map`ï¼ˆç±»åˆ«æ˜ å°„ï¼‰ç­‰ã€‚åŒæ—¶ï¼Œå®ƒè¿˜åˆå§‹åŒ–äº†ä¸€äº›è¯„ä¼°æŒ‡æ ‡ï¼Œå¦‚ `DetMetrics` å’Œæ··æ·†çŸ©é˜µ `ConfusionMatrix`ã€‚

`preprocess` æ–¹æ³•ç”¨äºå¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å°†å›¾åƒæ•°æ®è½¬ç§»åˆ°è®¾å¤‡ä¸Šã€è°ƒæ•´æ•°æ®ç±»å‹å’Œå½’ä¸€åŒ–å¤„ç†ã€‚è‹¥è®¾ç½®äº†ä¿å­˜æ··åˆæ ‡ç­¾çš„é€‰é¡¹ï¼Œè¿˜ä¼šç”Ÿæˆç”¨äºè‡ªåŠ¨æ ‡æ³¨çš„æ ‡ç­¾ã€‚

`init_metrics` æ–¹æ³•åˆå§‹åŒ–è¯„ä¼°æŒ‡æ ‡ï¼Œæ£€æŸ¥æ•°æ®é›†æ˜¯å¦ä¸º COCO æ ¼å¼ï¼Œå¹¶è®¾ç½®ç›¸åº”çš„ç±»åˆ«æ˜ å°„å’Œåç§°ã€‚

`postprocess` æ–¹æ³•å¯¹æ¨¡å‹çš„é¢„æµ‹ç»“æœåº”ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰ï¼Œä»¥å‡å°‘é‡å çš„æ£€æµ‹æ¡†ã€‚

`_prepare_batch` å’Œ `_prepare_pred` æ–¹æ³•åˆ†åˆ«ç”¨äºå‡†å¤‡è¾“å…¥æ‰¹æ¬¡å’Œé¢„æµ‹ç»“æœï¼Œä»¥ä¾¿åç»­çš„è¯„ä¼°å’Œè®¡ç®—ã€‚

`update_metrics` æ–¹æ³•è´Ÿè´£æ›´æ–°æ¨¡å‹çš„è¯„ä¼°æŒ‡æ ‡ï¼ŒåŒ…æ‹¬å¤„ç†æ¯ä¸ªæ‰¹æ¬¡çš„é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾ï¼Œè®¡ç®—æ­£ç¡®é¢„æµ‹çš„æ•°é‡ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚

`finalize_metrics` æ–¹æ³•ç”¨äºè®¾ç½®æœ€ç»ˆçš„æŒ‡æ ‡å€¼å’Œæ··æ·†çŸ©é˜µã€‚

`get_stats` æ–¹æ³•è¿”å›å½“å‰çš„æŒ‡æ ‡ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶è®¡ç®—æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡æ•°é‡ã€‚

`print_results` æ–¹æ³•è¾“å‡ºè®­ç»ƒæˆ–éªŒè¯é›†çš„æ¯ä¸ªç±»åˆ«çš„æŒ‡æ ‡ç»“æœï¼ŒåŒ…æ‹¬å›¾åƒæ•°é‡ã€å®ä¾‹æ•°é‡å’Œå„ç±»æŒ‡æ ‡çš„å¹³å‡å€¼ã€‚

`_process_batch` æ–¹æ³•ç”¨äºè®¡ç®—æ­£ç¡®é¢„æµ‹çš„çŸ©é˜µï¼Œè¿”å›æ¯ä¸ªé¢„æµ‹æ¡†ä¸çœŸå®æ¡†çš„ IoU å€¼ã€‚

`build_dataset` å’Œ `get_dataloader` æ–¹æ³•ç”¨äºæ„å»ºæ•°æ®é›†å’Œæ•°æ®åŠ è½½å™¨ï¼Œä»¥ä¾¿åœ¨éªŒè¯è¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚

`plot_val_samples` å’Œ `plot_predictions` æ–¹æ³•ç”¨äºå¯è§†åŒ–éªŒè¯æ ·æœ¬å’Œé¢„æµ‹ç»“æœï¼Œç”Ÿæˆç›¸åº”çš„å›¾åƒæ–‡ä»¶ã€‚

`save_one_txt` æ–¹æ³•å°† YOLO æ£€æµ‹ç»“æœä¿å­˜åˆ°æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œæ ¼å¼ä¸ºå½’ä¸€åŒ–åæ ‡ã€‚

`pred_to_json` æ–¹æ³•å°†é¢„æµ‹ç»“æœåºåˆ—åŒ–ä¸º COCO JSON æ ¼å¼ï¼Œä»¥ä¾¿åç»­è¯„ä¼°ã€‚

`eval_json` æ–¹æ³•ç”¨äºè¯„ä¼° YOLO è¾“å‡ºçš„ JSON æ ¼å¼ç»“æœï¼Œå¹¶è¿”å›æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯ï¼Œä½¿ç”¨ COCO API è®¡ç®— mAPï¼ˆå¹³å‡ç²¾åº¦ï¼‰ã€‚

æ•´ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹éªŒè¯æµç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®å¤„ç†ã€æŒ‡æ ‡è®¡ç®—ã€ç»“æœè¾“å‡ºå’Œå¯è§†åŒ–ï¼Œé€‚ç”¨äºä½¿ç”¨ YOLO æ¨¡å‹è¿›è¡Œç›®æ ‡æ£€æµ‹çš„åœºæ™¯ã€‚

#### 10.4 fast_kan_conv.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import torch
import torch.nn as nn

# å®šä¹‰å¾„å‘åŸºå‡½æ•°ï¼ˆRadial Basis Functionï¼‰ç±»
class RadialBasisFunction(nn.Module):
    def __init__(self, grid_min: float = -2., grid_max: float = 2., num_grids: int = 8, denominator: float = None):
        super().__init__()
        # åœ¨æŒ‡å®šèŒƒå›´å†…ç”Ÿæˆå‡åŒ€åˆ†å¸ƒçš„ç½‘æ ¼ç‚¹
        grid = torch.linspace(grid_min, grid_max, num_grids)
        self.grid = torch.nn.Parameter(grid, requires_grad=False)  # å°†ç½‘æ ¼ç‚¹è®¾ä¸ºä¸å¯è®­ç»ƒçš„å‚æ•°
        # è®¾ç½®åˆ†æ¯ï¼Œç”¨äºæ§åˆ¶åŸºå‡½æ•°çš„å¹³æ»‘åº¦
        self.denominator = denominator or (grid_max - grid_min) / (num_grids - 1)

    def forward(self, x):
        # è®¡ç®—å¾„å‘åŸºå‡½æ•°çš„è¾“å‡º
        return torch.exp(-((x[..., None] - self.grid) / self.denominator) ** 2)

# å®šä¹‰å¿«é€ŸKANå·ç§¯å±‚çš„åŸºç±»
class FastKANConvNDLayer(nn.Module):
    def __init__(self, conv_class, norm_class, input_dim, output_dim, kernel_size, groups=1, padding=0, stride=1, dilation=1, ndim: int = 2, grid_size=8, base_activation=nn.SiLU, grid_range=[-2, 2], dropout=0.0):
        super(FastKANConvNDLayer, self).__init__()
        # åˆå§‹åŒ–å·ç§¯å±‚çš„å‚æ•°
        self.inputdim = input_dim
        self.outdim = output_dim
        self.kernel_size = kernel_size
        self.padding = padding
        self.stride = stride
        self.dilation = dilation
        self.groups = groups
        self.ndim = ndim
        self.grid_size = grid_size
        self.base_activation = base_activation()  # åŸºç¡€æ¿€æ´»å‡½æ•°
        self.grid_range = grid_range

        # æ£€æŸ¥è¾“å…¥å‚æ•°çš„æœ‰æ•ˆæ€§
        if groups <= 0:
            raise ValueError('groups must be a positive integer')
        if input_dim % groups != 0:
            raise ValueError('input_dim must be divisible by groups')
        if output_dim % groups != 0:
            raise ValueError('output_dim must be divisible by groups')

        # åˆ›å»ºåŸºç¡€å·ç§¯å±‚å’Œæ ·æ¡å·ç§¯å±‚
        self.base_conv = nn.ModuleList([conv_class(input_dim // groups, output_dim // groups, kernel_size, stride, padding, dilation, groups=1, bias=False) for _ in range(groups)])
        self.spline_conv = nn.ModuleList([conv_class(grid_size * input_dim // groups, output_dim // groups, kernel_size, stride, padding, dilation, groups=1, bias=False) for _ in range(groups)])
        self.layer_norm = nn.ModuleList([norm_class(output_dim // groups) for _ in range(groups)])

        # åˆå§‹åŒ–å¾„å‘åŸºå‡½æ•°
        self.rbf = RadialBasisFunction(grid_range[0], grid_range[1], grid_size)

        # åˆå§‹åŒ–dropoutå±‚
        self.dropout = nn.Dropout(p=dropout) if dropout > 0 else None

        # ä½¿ç”¨Kaimingå‡åŒ€åˆ†å¸ƒåˆå§‹åŒ–å·ç§¯å±‚çš„æƒé‡
        for conv_layer in self.base_conv:
            nn.init.kaiming_uniform_(conv_layer.weight, nonlinearity='linear')
        for conv_layer in self.spline_conv:
            nn.init.kaiming_uniform_(conv_layer.weight, nonlinearity='linear')

    def forward_fast_kan(self, x, group_index):
        # å¿«é€ŸKANå·ç§¯çš„å‰å‘ä¼ æ’­
        base_output = self.base_conv[group_index](self.base_activation(x))  # åº”ç”¨åŸºç¡€æ¿€æ´»å’Œå·ç§¯
        if self.dropout is not None:
            x = self.dropout(x)  # åº”ç”¨dropout
        spline_basis = self.rbf(self.layer_norm[group_index](x))  # è®¡ç®—æ ·æ¡åŸº
        spline_basis = spline_basis.moveaxis(-1, 2).flatten(1, 2)  # è°ƒæ•´ç»´åº¦ä»¥é€‚åº”å·ç§¯å±‚
        spline_output = self.spline_conv[group_index](spline_basis)  # åº”ç”¨æ ·æ¡å·ç§¯
        x = base_output + spline_output  # åˆå¹¶åŸºç¡€è¾“å‡ºå’Œæ ·æ¡è¾“å‡º

        return x

    def forward(self, x):
        # å¯¹è¾“å…¥è¿›è¡Œåˆ†ç»„å¹¶è¿›è¡Œå‰å‘ä¼ æ’­
        split_x = torch.split(x, self.inputdim // self.groups, dim=1)
        output = []
        for group_ind, _x in enumerate(split_x):
            y = self.forward_fast_kan(_x.clone(), group_ind)  # è°ƒç”¨å¿«é€ŸKANå·ç§¯
            output.append(y.clone())
        y = torch.cat(output, dim=1)  # åˆå¹¶æ‰€æœ‰ç»„çš„è¾“å‡º
        return y
```

### ä»£ç è¯´æ˜ï¼š
1. **RadialBasisFunction**ï¼šå®ç°äº†å¾„å‘åŸºå‡½æ•°ï¼Œä¸»è¦ç”¨äºç”Ÿæˆå¹³æ»‘çš„åŸºå‡½æ•°è¾“å‡ºã€‚
2. **FastKANConvNDLayer**ï¼šæ˜¯ä¸€ä¸ªå·ç§¯å±‚çš„åŸºç±»ï¼Œæ”¯æŒå¤šç»´å·ç§¯ï¼ˆ1Dã€2Dã€3Dï¼‰ï¼ŒåŒ…æ‹¬åŸºç¡€å·ç§¯å’Œæ ·æ¡å·ç§¯ã€‚
3. **forward_fast_kan**ï¼šå®ç°äº†å¿«é€ŸKANå·ç§¯çš„å‰å‘ä¼ æ’­é€»è¾‘ï¼Œè®¡ç®—åŸºç¡€å·ç§¯å’Œæ ·æ¡å·ç§¯çš„è¾“å‡ºå¹¶åˆå¹¶ã€‚
4. **forward**ï¼šå¤„ç†è¾“å…¥æ•°æ®çš„åˆ†ç»„ï¼Œå¹¶è°ƒç”¨`forward_fast_kan`è¿›è¡Œè®¡ç®—ï¼Œæœ€ååˆå¹¶è¾“å‡ºã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªç”¨äºå¿«é€Ÿå·ç§¯ç¥ç»ç½‘ç»œçš„æ¨¡å—ï¼Œä¸»è¦åŒ…å«äº†å‡ ä¸ªç±»ï¼Œåˆ†åˆ«ç”¨äºå®ç°ä¸åŒç»´åº¦çš„å·ç§¯å±‚ã€‚é¦–å…ˆï¼Œ`RadialBasisFunction`ç±»å®ç°äº†ä¸€ä¸ªå¾„å‘åŸºå‡½æ•°ï¼Œä¸»è¦ç”¨äºç”Ÿæˆå¹³æ»‘çš„åŸºå‡½æ•°ã€‚å®ƒçš„æ„é€ å‡½æ•°æ¥å—æœ€å°å’Œæœ€å¤§ç½‘æ ¼å€¼ã€ç½‘æ ¼æ•°é‡ä»¥åŠåˆ†æ¯å€¼ã€‚`forward`æ–¹æ³•è®¡ç®—è¾“å…¥ä¸ç½‘æ ¼ä¹‹é—´çš„è·ç¦»ï¼Œå¹¶é€šè¿‡æŒ‡æ•°å‡½æ•°ç”Ÿæˆå¾„å‘åŸºå‡½æ•°çš„è¾“å‡ºã€‚

æ¥ä¸‹æ¥ï¼Œ`FastKANConvNDLayer`ç±»æ˜¯ä¸€ä¸ªé€šç”¨çš„å¤šç»´å·ç§¯å±‚ï¼Œç»§æ‰¿è‡ª`nn.Module`ã€‚åœ¨å…¶æ„é€ å‡½æ•°ä¸­ï¼Œå®šä¹‰äº†è¾“å…¥å’Œè¾“å‡ºç»´åº¦ã€å·ç§¯æ ¸å¤§å°ã€åˆ†ç»„æ•°ã€å¡«å……ã€æ­¥å¹…ã€æ‰©å¼ ã€ç½‘æ ¼å¤§å°ç­‰å‚æ•°ï¼Œå¹¶è¿›è¡Œäº†ä¸€ç³»åˆ—çš„å‚æ•°éªŒè¯ã€‚è¯¥ç±»ä½¿ç”¨`ModuleList`æ¥å­˜å‚¨åŸºç¡€å·ç§¯å±‚ã€æ ·æ¡å·ç§¯å±‚å’Œå±‚å½’ä¸€åŒ–å±‚ï¼Œå¹¶åˆå§‹åŒ–äº†ä¸€ä¸ªå¾„å‘åŸºå‡½æ•°å®ä¾‹ã€‚æ ¹æ®ç»™å®šçš„ç»´åº¦ï¼Œå¯èƒ½ä¼šæ·»åŠ ä¸¢å¼ƒå±‚ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚å·ç§¯å±‚çš„æƒé‡ä½¿ç”¨Kaimingå‡åŒ€åˆ†å¸ƒè¿›è¡Œåˆå§‹åŒ–ï¼Œä»¥æé«˜è®­ç»ƒçš„èµ·å§‹æ•ˆæœã€‚

`forward_fast_kan`æ–¹æ³•æ˜¯è¯¥ç±»çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¤„ç†è¾“å…¥æ•°æ®å¹¶é€šè¿‡åŸºç¡€å·ç§¯å’Œæ ·æ¡å·ç§¯ç”Ÿæˆè¾“å‡ºã€‚è¾“å…¥æ•°æ®é¦–å…ˆç»è¿‡åŸºç¡€æ¿€æ´»å‡½æ•°ï¼Œç„¶åè¿›è¡Œçº¿æ€§å˜æ¢ã€‚æ¥ç€ï¼Œæ ·æ¡åŸºå‡½æ•°é€šè¿‡å±‚å½’ä¸€åŒ–å¤„ç†åè¿›è¡Œå·ç§¯ï¼Œæœ€åå°†åŸºç¡€è¾“å‡ºå’Œæ ·æ¡è¾“å‡ºç›¸åŠ å¾—åˆ°æœ€ç»ˆç»“æœã€‚

`forward`æ–¹æ³•åˆ™å°†è¾“å…¥æ•°æ®æŒ‰ç…§åˆ†ç»„è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶å¯¹æ¯ä¸ªåˆ†ç»„è°ƒç”¨`forward_fast_kan`è¿›è¡Œå¤„ç†ï¼Œæœ€åå°†æ‰€æœ‰è¾“å‡ºæ‹¼æ¥åœ¨ä¸€èµ·ã€‚

æ–‡ä»¶ä¸­è¿˜å®šä¹‰äº†ä¸‰ä¸ªå…·ä½“çš„å·ç§¯å±‚ç±»ï¼š`FastKANConv3DLayer`ã€`FastKANConv2DLayer`å’Œ`FastKANConv1DLayer`ï¼Œåˆ†åˆ«ç”¨äºä¸‰ç»´ã€äºŒç»´å’Œä¸€ç»´å·ç§¯æ“ä½œã€‚è¿™äº›ç±»é€šè¿‡è°ƒç”¨`FastKANConvNDLayer`çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–ç›¸åº”çš„å·ç§¯å±‚ï¼ŒæŒ‡å®šç›¸åº”çš„å·ç§¯ç±»å‹å’Œå½’ä¸€åŒ–ç±»å‹ã€‚

æ•´ä½“è€Œè¨€ï¼Œè¿™ä¸ªç¨‹åºæ–‡ä»¶å®ç°äº†ä¸€ä¸ªçµæ´»ä¸”é«˜æ•ˆçš„å·ç§¯ç¥ç»ç½‘ç»œæ¨¡å—ï¼Œèƒ½å¤Ÿæ”¯æŒå¤šç»´å·ç§¯æ“ä½œï¼Œå¹¶é€šè¿‡å¾„å‘åŸºå‡½æ•°å¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚

### 11.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+200+ç§å…¨å¥—åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/Z5eTmJ1v](https://mbd.pub/o/bread/Z5eTmJ1v)